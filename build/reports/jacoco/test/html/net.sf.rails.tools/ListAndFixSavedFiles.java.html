<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="de"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ListAndFixSavedFiles.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Rails</a> &gt; <a href="index.source.html" class="el_package">net.sf.rails.tools</a> &gt; <span class="el_source">ListAndFixSavedFiles.java</span></div><h1>ListAndFixSavedFiles.java</h1><pre class="source lang-java linenums">package net.sf.rails.tools;

import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.KeyEvent;
import java.awt.event.KeyListener;
import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import javax.swing.*;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import net.sf.rails.common.Config;
import net.sf.rails.common.ConfigManager;
import net.sf.rails.common.LocalText;
import net.sf.rails.game.MapHex;
import net.sf.rails.game.RailsRoot;
import net.sf.rails.game.Tile;
import net.sf.rails.game.Train;
import net.sf.rails.ui.swing.elements.ActionMenuItem;
import net.sf.rails.util.GameLoader;
import net.sf.rails.util.GameSaver;
import net.sf.rails.util.Util;
import rails.game.action.BuyTrain;
import rails.game.action.LayTile;
import rails.game.action.PossibleAction;


public class ListAndFixSavedFiles extends JFrame implements ActionListener, KeyListener {
    private static final long serialVersionUID = 1L;

    private JTextArea reportText;
    private JScrollPane messageScroller;
    private JScrollBar vbar;
    private JPanel messagePanel;
    private ListAndFixSavedFiles messageWindow;
    private JMenuBar menuBar;
    private JMenu fileMenu, editMenu;
    private JMenuItem saveItem, loadItem;
    private JMenuItem trimItem, deleteItem, correctItem;

    private int correctedIndex;
    private PossibleAction correctedAction;

<span class="nc" id="L50">    private StringBuffer headerText = new StringBuffer();</span>

    private GameLoader gameLoader;

    private int vbarPos;

    private static String saveDirectory;
    private String filepath;
    private RailsRoot root;

    private static Logger log;

    /**
     * @param args
     */
    public static void main(String[] args) {
        // intialize configuration
<span class="nc" id="L67">        ConfigManager.initConfiguration(false);</span>

        // delayed setting of logger
<span class="nc" id="L70">        log = LoggerFactory.getLogger(ListAndFixSavedFiles.class);</span>

<span class="nc" id="L72">        saveDirectory = Config.get(&quot;save.directory&quot;);</span>
<span class="nc" id="L73">        log.warn(&quot;Save directory = {}&quot;, saveDirectory);</span>

<span class="nc" id="L75">        new ListAndFixSavedFiles ();</span>
<span class="nc" id="L76">    }</span>

    public ListAndFixSavedFiles () {
<span class="nc" id="L79">        super();</span>

<span class="nc" id="L81">        messageWindow = this;</span>

<span class="nc" id="L83">        reportText = new JTextArea();</span>
<span class="nc" id="L84">        reportText.setEditable(false);</span>
<span class="nc" id="L85">        reportText.setLineWrap(false);</span>
<span class="nc" id="L86">        reportText.setBackground(Color.WHITE);</span>
<span class="nc" id="L87">        reportText.setOpaque(true);</span>
<span class="nc" id="L88">        reportText.setBorder(BorderFactory.createEmptyBorder(5, 5, 5, 5));</span>

<span class="nc" id="L90">        messagePanel = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L91">        messageScroller =</span>
            new JScrollPane(reportText,
                    ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS,
                    ScrollPaneConstants.HORIZONTAL_SCROLLBAR_AS_NEEDED);
<span class="nc" id="L95">        vbar = messageScroller.getVerticalScrollBar();</span>
<span class="nc" id="L96">        GridBagConstraints gbc = new GridBagConstraints();</span>
<span class="nc" id="L97">        gbc.gridx = gbc.gridy = 0;</span>
<span class="nc" id="L98">        gbc.weightx = gbc.weighty = 1.0;</span>
<span class="nc" id="L99">        gbc.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L100">        messagePanel.add(messageScroller, gbc);</span>

<span class="nc" id="L102">        menuBar = new JMenuBar();</span>
<span class="nc" id="L103">        fileMenu = new JMenu(LocalText.getText(&quot;FILE&quot;));</span>
<span class="nc" id="L104">        fileMenu.setMnemonic(KeyEvent.VK_F);</span>
<span class="nc" id="L105">        editMenu = new JMenu(LocalText.getText(&quot;EDIT&quot;));</span>
<span class="nc" id="L106">        editMenu.setMnemonic(KeyEvent.VK_E);</span>

<span class="nc" id="L108">        loadItem = new ActionMenuItem(LocalText.getText(&quot;LOAD&quot;));</span>
<span class="nc" id="L109">        loadItem.setActionCommand(&quot;LOAD&quot;);</span>
<span class="nc" id="L110">        loadItem.setMnemonic(KeyEvent.VK_L);</span>
<span class="nc" id="L111">        loadItem.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_L,</span>
                ActionEvent.ALT_MASK));
<span class="nc" id="L113">        loadItem.addActionListener(this);</span>
<span class="nc" id="L114">        loadItem.setEnabled(true);</span>
<span class="nc" id="L115">        fileMenu.add(loadItem);</span>

<span class="nc" id="L117">        saveItem = new ActionMenuItem(LocalText.getText(&quot;SAVE&quot;));</span>
<span class="nc" id="L118">        saveItem.setActionCommand(&quot;SAVE&quot;);</span>
<span class="nc" id="L119">        saveItem.setMnemonic(KeyEvent.VK_S);</span>
<span class="nc" id="L120">        saveItem.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_S,</span>
                ActionEvent.ALT_MASK));
<span class="nc" id="L122">        saveItem.addActionListener(this);</span>
<span class="nc" id="L123">        saveItem.setEnabled(true);</span>
<span class="nc" id="L124">        fileMenu.add(saveItem);</span>

<span class="nc" id="L126">        trimItem = new ActionMenuItem(&quot;Trim&quot;);</span>
<span class="nc" id="L127">        trimItem.setActionCommand(&quot;TRIM&quot;);</span>
<span class="nc" id="L128">        trimItem.setMnemonic(KeyEvent.VK_T);</span>
<span class="nc" id="L129">        trimItem.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_T,</span>
                ActionEvent.ALT_MASK));
<span class="nc" id="L131">        trimItem.addActionListener(this);</span>
<span class="nc" id="L132">        trimItem.setEnabled(true);</span>
<span class="nc" id="L133">        editMenu.add(trimItem);</span>

<span class="nc" id="L135">        deleteItem = new ActionMenuItem(&quot;Delete&quot;);</span>
<span class="nc" id="L136">        deleteItem.setActionCommand(&quot;DELETE&quot;);</span>
<span class="nc" id="L137">        deleteItem.setMnemonic(KeyEvent.VK_D);</span>
<span class="nc" id="L138">        deleteItem.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_D,</span>
                ActionEvent.ALT_MASK));
<span class="nc" id="L140">        deleteItem.addActionListener(this);</span>
<span class="nc" id="L141">        deleteItem.setEnabled(true);</span>
<span class="nc" id="L142">        editMenu.add(deleteItem);</span>

<span class="nc" id="L144">        correctItem = new ActionMenuItem(&quot;Correct&quot;);</span>
<span class="nc" id="L145">        correctItem.setActionCommand(&quot;CORRECT&quot;);</span>
<span class="nc" id="L146">        correctItem.setMnemonic(KeyEvent.VK_C);</span>
<span class="nc" id="L147">        correctItem.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_C,</span>
                ActionEvent.ALT_MASK));
<span class="nc" id="L149">        correctItem.addActionListener(this);</span>
<span class="nc" id="L150">        correctItem.setEnabled(true);</span>
<span class="nc" id="L151">        editMenu.add(correctItem);</span>

<span class="nc" id="L153">        menuBar.add(fileMenu);</span>
<span class="nc" id="L154">        menuBar.add(editMenu);</span>

<span class="nc" id="L156">        setJMenuBar(menuBar);</span>

<span class="nc" id="L158">        setContentPane(messagePanel);</span>

<span class="nc" id="L160">        setSize(400, 400);</span>
<span class="nc" id="L161">        setLocation(600, 400);</span>
<span class="nc" id="L162">        setTitle(&quot;List and fix saved files&quot;);</span>

<span class="nc" id="L164">        addKeyListener(this);</span>

<span class="nc" id="L166">        setVisible(true);</span>

<span class="nc" id="L168">        saveDirectory = Config.get(&quot;save.directory&quot;);</span>

//        load();
<span class="nc" id="L171">    }</span>

    private void load() {
<span class="nc" id="L174">        JFileChooser jfc = new JFileChooser();</span>
<span class="nc" id="L175">        jfc.setCurrentDirectory(new File(saveDirectory));</span>

<span class="nc bnc" id="L177" title="All 2 branches missed.">        if (jfc.showOpenDialog(getContentPane()) == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L178">            File selectedFile = jfc.getSelectedFile();</span>
<span class="nc" id="L179">            filepath = selectedFile.getPath();</span>
<span class="nc" id="L180">            saveDirectory = selectedFile.getParent();</span>

            // clear header text
<span class="nc" id="L183">            headerText = new StringBuffer();</span>

            // use GameLoader object to load game
<span class="nc" id="L186">            gameLoader = new GameLoader();</span>
            try{
<span class="nc" id="L188">                gameLoader.createFromFile(selectedFile);</span>
<span class="nc" id="L189">                add(gameLoader.getGameDataAsText());</span>
                //gameLoader.getRoot().start();
<span class="nc" id="L191">                setReportText(true);</span>
<span class="nc" id="L192">            } catch (Exception e)  {</span>
<span class="nc" id="L193">                log.error(&quot;exception&quot;, e);</span>
<span class="nc" id="L194">            }</span>
<span class="nc" id="L195">            root = gameLoader.getRoot();</span>
        }
<span class="nc" id="L197">    }</span>

    public void add (String text) {
<span class="nc bnc" id="L200" title="All 2 branches missed.">        if (text.length() &gt; 0) {</span>
<span class="nc" id="L201">            headerText.append(text);</span>
<span class="nc" id="L202">            headerText.append(&quot;\n&quot;);</span>
        }
<span class="nc" id="L204">    }</span>

    private void setReportText(boolean initial) {
<span class="nc bnc" id="L207" title="All 2 branches missed.">        if (initial)</span>
<span class="nc" id="L208">            vbarPos = -1;</span>
        else
<span class="nc" id="L210">            vbarPos = this.vbar.getValue();</span>

<span class="nc" id="L212">        reportText.setText(headerText.toString());</span>
        // append actionText
<span class="nc" id="L214">        int i=0;</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">        for (PossibleAction action : gameLoader.getActions()) {</span>
<span class="nc" id="L216">            reportText.append(&quot;Action &quot;+i+&quot; &quot;+action.getPlayerName()+&quot;(&quot; + action.getPlayerIndex() + &quot;): &quot;+action.toString());</span>
<span class="nc" id="L217">            reportText.append(&quot;\n&quot;);</span>
<span class="nc" id="L218">            i++;</span>
<span class="nc" id="L219">        }</span>
<span class="nc" id="L220">        scrollDown(vbarPos);</span>
<span class="nc" id="L221">    }</span>


    public void scrollDown (int pos) {
<span class="nc" id="L225">        SwingUtilities.invokeLater(new Runnable() {</span>
            public void run() {
<span class="nc bnc" id="L227" title="All 2 branches missed.">                if (vbarPos == -1)</span>
<span class="nc" id="L228">                    messageWindow.vbar.setValue(messageWindow.vbar.getMaximum());</span>
                else
<span class="nc" id="L230">                    messageWindow.vbar.setValue(vbarPos);</span>
<span class="nc" id="L231">            }</span>
        });
<span class="nc" id="L233">    }</span>

    public void actionPerformed(ActionEvent actor) {
<span class="nc" id="L236">        String command = actor.getActionCommand();</span>
<span class="nc bnc" id="L237" title="All 2 branches missed.">        if (&quot;TRIM&quot;.equalsIgnoreCase(command)) {</span>
<span class="nc" id="L238">            String result = JOptionPane.showInputDialog(&quot;Enter last action number to be retained&quot;);</span>
<span class="nc bnc" id="L239" title="All 2 branches missed.">            if (Util.hasValue(result)) {</span>
                try {
<span class="nc" id="L241">                    int index = Integer.parseInt(result);</span>
                    // delete actions
<span class="nc" id="L243">                    int size = gameLoader.getActions().size();</span>
<span class="nc" id="L244">                    gameLoader.getActions().subList(index + 1, size).clear();</span>
<span class="nc" id="L245">                    setReportText(false);</span>
<span class="nc" id="L246">                } catch (NumberFormatException e) {</span>

<span class="nc" id="L248">                }</span>
            }
<span class="nc bnc" id="L250" title="All 2 branches missed.">        } else if (&quot;DELETE&quot;.equalsIgnoreCase(command)) {</span>
<span class="nc" id="L251">            String result = JOptionPane.showInputDialog(&quot;Enter action number to be deleted&quot;);</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">            if (Util.hasValue(result)) {</span>
                try {
<span class="nc" id="L254">                    int index = Integer.parseInt(result);</span>
<span class="nc" id="L255">                    gameLoader.getActions().remove(index);</span>
<span class="nc" id="L256">                    setReportText(false);</span>
<span class="nc" id="L257">                } catch (NumberFormatException e) {</span>
<span class="nc" id="L258">                    log.error(&quot;Number format exception for '{}'&quot;, result, e);</span>
<span class="nc" id="L259">                }</span>
            }
<span class="nc bnc" id="L261" title="All 2 branches missed.">        } else if (&quot;CORRECT&quot;.equalsIgnoreCase(command)) {</span>
<span class="nc" id="L262">            String result = JOptionPane.showInputDialog(&quot;Enter action number to be corrected&quot;);</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">            if (Util.hasValue(result)) {</span>
                try {
<span class="nc" id="L265">                    int index = Integer.parseInt(result);</span>
<span class="nc" id="L266">                    correct (index);</span>
<span class="nc" id="L267">                } catch (NumberFormatException e) {</span>
<span class="nc" id="L268">                    log.error(&quot;Number format exception for '{}'&quot;, result, e);</span>
<span class="nc" id="L269">                }</span>
            }
<span class="nc bnc" id="L271" title="All 2 branches missed.">        } else if (&quot;SAVE&quot;.equalsIgnoreCase(command)) {</span>
<span class="nc" id="L272">            save();</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">        } else if (&quot;LOAD&quot;.equalsIgnoreCase(command)) {</span>
<span class="nc" id="L274">            load();</span>
        }
<span class="nc" id="L276">    }</span>

    private void save() {
<span class="nc" id="L279">        JFileChooser jfc = new JFileChooser();</span>
<span class="nc bnc" id="L280" title="All 2 branches missed.">        if (Util.hasValue(saveDirectory)) {</span>
<span class="nc" id="L281">            jfc.setCurrentDirectory(new File(saveDirectory));</span>
        }
<span class="nc bnc" id="L283" title="All 2 branches missed.">        if (Util.hasValue(filepath)) {</span>
<span class="nc" id="L284">            jfc.setSelectedFile(new File(filepath));</span>
        }
<span class="nc bnc" id="L286" title="All 2 branches missed.">        if (jfc.showSaveDialog(this) == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L287">            File selectedFile = jfc.getSelectedFile();</span>
<span class="nc" id="L288">            GameSaver gameSaver = new GameSaver(gameLoader);</span>
            try {
<span class="nc" id="L290">                gameSaver.saveGame(selectedFile);</span>
<span class="nc" id="L291">            } catch (IOException e) {</span>
<span class="nc" id="L292">                String message = LocalText.getText(&quot;SaveFailed&quot;, e.getMessage());</span>
<span class="nc" id="L293">                log.error(message);</span>
<span class="nc" id="L294">            }</span>
        }
<span class="nc" id="L296">    }</span>

    private void correct (int index) {
<span class="nc" id="L299">        correctedAction = gameLoader.getActions().get(index);</span>
<span class="nc" id="L300">        correctedIndex = index;</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">        if (correctedAction instanceof BuyTrain) {</span>
<span class="nc" id="L302">            new BuyTrainDialog ((BuyTrain)correctedAction);</span>
<span class="nc bnc" id="L303" title="All 2 branches missed.">        } else if (correctedAction instanceof LayTile) {</span>
<span class="nc" id="L304">            new LayTileDialog ((LayTile)correctedAction);</span>
        } else {
<span class="nc" id="L306">            JOptionPane.showMessageDialog(this, &quot;Action type '&quot; + correctedAction.getClass().getSimpleName()</span>
                    + &quot;' cannot yet be edited&quot;);
        }
<span class="nc" id="L309">    }</span>

    protected void processCorrections (PossibleAction newAction) {
<span class="nc bnc" id="L312" title="All 4 branches missed.">        if (newAction != null &amp;&amp; !newAction.equalsAsAction(correctedAction)) {</span>
<span class="nc" id="L313">            gameLoader.getActions().set(correctedIndex, newAction);</span>
<span class="nc" id="L314">            setReportText(false);</span>
        }
<span class="nc" id="L316">    }</span>

    private abstract class EditDialog extends JDialog implements ActionListener {

        private static final long serialVersionUID = 1L;
<span class="nc" id="L321">        private List&lt;Object&gt; originalValues = new ArrayList&lt;Object&gt;();</span>
<span class="nc" id="L322">        protected List&lt;JComponent&gt; inputElements = new ArrayList&lt;JComponent&gt;();</span>
<span class="nc" id="L323">        private GridBagConstraints gc = new GridBagConstraints();</span>
<span class="nc" id="L324">        private int length = 0;</span>
        private JButton okButton, cancelButton;

<span class="nc" id="L327">        EditDialog (String title) {</span>
<span class="nc" id="L328">            super((Frame) null, title, false); // Non-modal</span>
<span class="nc" id="L329">            getContentPane().setLayout(new GridBagLayout());</span>
<span class="nc" id="L330">            setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);</span>
<span class="nc" id="L331">        }</span>

        void finish() {
<span class="nc" id="L334">            addField (this, okButton = new JButton(&quot;OK&quot;), ++length, 0);</span>
<span class="nc" id="L335">            okButton.addActionListener(this);</span>
<span class="nc" id="L336">            addField (this, cancelButton = new JButton(&quot;Cancel&quot;), length, 1);</span>
<span class="nc" id="L337">            cancelButton.addActionListener(this);</span>
<span class="nc" id="L338">            pack();</span>

            // Center on window
<span class="nc" id="L341">            int x = (int) messageWindow.getLocationOnScreen().getX()</span>
<span class="nc" id="L342">            + (messageWindow.getWidth() - getWidth()) / 2;</span>
<span class="nc" id="L343">            int y = (int) messageWindow.getLocationOnScreen().getY()</span>
<span class="nc" id="L344">            + (messageWindow.getHeight() - getHeight()) / 2;</span>
<span class="nc" id="L345">            setLocation(x, y);</span>

<span class="nc" id="L347">            setVisible(true);</span>
<span class="nc" id="L348">            setAlwaysOnTop(true);</span>
<span class="nc" id="L349">        }</span>

        public void actionPerformed(ActionEvent arg0) {
<span class="nc bnc" id="L352" title="All 2 branches missed.">            if (arg0.getSource().equals(okButton)) {</span>
<span class="nc" id="L353">                PossibleAction newAction = processInput();</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">                if (newAction != null) messageWindow.processCorrections(newAction);</span>
<span class="nc bnc" id="L355" title="All 2 branches missed.">            } else if (arg0.getSource().equals(cancelButton)) {;</span>

            }
<span class="nc" id="L358">            this.setVisible(false);</span>
<span class="nc" id="L359">            this.dispose();</span>

<span class="nc" id="L361">        }</span>

        abstract PossibleAction processInput();
    }

    private class BuyTrainDialog extends EditDialog {
        private static final long serialVersionUID = 1L;
        private BuyTrain action;

<span class="nc" id="L370">        BuyTrainDialog (BuyTrain action) {</span>
<span class="nc" id="L371">            super (&quot;Edit BuyTrain&quot;);</span>
<span class="nc" id="L372">            this.action = action;</span>
<span class="nc" id="L373">            addLabel (this, &quot;Train UID&quot;, null, action.getTrain().getId());  // 0</span>
<span class="nc" id="L374">            addLabel (this, &quot;From Portfolio&quot;, null, action.getFromOwner().getId());  // 1</span>
<span class="nc" id="L375">            addTextField (this, &quot;Price paid&quot;,</span>
<span class="nc" id="L376">                    action.getPricePaid(),</span>
<span class="nc" id="L377">                    String.valueOf(action.getPricePaid()));  // 2</span>
<span class="nc" id="L378">            addTextField (this, &quot;Added cash&quot;,</span>
<span class="nc" id="L379">                    action.getAddedCash(),</span>
<span class="nc" id="L380">                    String.valueOf(action.getAddedCash()));  // 3</span>
<span class="nc" id="L381">            addTextField (this, &quot;Exchange train UID&quot;,</span>
<span class="nc" id="L382">                    action.getExchangedTrain(),</span>
<span class="nc bnc" id="L383" title="All 2 branches missed.">                    action.getExchangedTrain() != null ? action.getExchangedTrain().getId() : &quot;&quot;);  // 4</span>
<span class="nc" id="L384">            addTextField (this, &quot;Fixed Price&quot;,</span>
<span class="nc" id="L385">                    action.getFixedCost(),</span>
<span class="nc" id="L386">                    String.valueOf(action.getFixedCost()));  // 5</span>
<span class="nc" id="L387">            finish();</span>
<span class="nc" id="L388">        }</span>

        @Override
        PossibleAction processInput() {
<span class="nc" id="L392">            log.debug(&quot;Action was {}&quot;, action);</span>
            try {
<span class="nc" id="L394">                int pricePaid = Integer.parseInt(((JTextField)inputElements.get(2)).getText());</span>
<span class="nc" id="L395">                action.setPricePaid(pricePaid);</span>
<span class="nc" id="L396">            } catch (NumberFormatException e) {</span>
<span class="nc" id="L397">            }</span>
            try {
<span class="nc" id="L399">                int addedCash = Integer.parseInt(((JTextField)inputElements.get(3)).getText());</span>
<span class="nc" id="L400">                action.setAddedCash(addedCash);</span>
<span class="nc" id="L401">            } catch (NumberFormatException e) {</span>
<span class="nc" id="L402">            }</span>
<span class="nc" id="L403">            String exchangedTrainID = ((JTextField)inputElements.get(4)).getText();</span>
<span class="nc" id="L404">            Train exchangedTrain = root.getTrainManager().getTrainByUniqueId(exchangedTrainID);</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">            if (exchangedTrain != null) action.setExchangedTrain(exchangedTrain);</span>
            try {
<span class="nc" id="L407">                int fixedCost = Integer.parseInt(((JTextField)inputElements.get(5)).getText());</span>
<span class="nc" id="L408">                action.setFixedCost(fixedCost);</span>
<span class="nc" id="L409">            } catch (NumberFormatException e) {</span>
<span class="nc" id="L410">            }</span>

<span class="nc" id="L412">            log.debug(&quot;Action is  {}&quot;, action);</span>
<span class="nc" id="L413">            return action;</span>

        }
    }

    private class LayTileDialog extends EditDialog {
        private static final long serialVersionUID = 1L;
        private LayTile action;

<span class="nc" id="L422">        LayTileDialog (LayTile action) {</span>
<span class="nc" id="L423">            super (&quot;Edit LayTile&quot;);</span>
<span class="nc" id="L424">            this.action = action;</span>
<span class="nc" id="L425">            addTextField (this, &quot;Tile laid&quot;,</span>
<span class="nc" id="L426">                    action.getLaidTile(),</span>
<span class="nc" id="L427">                    action.getLaidTile().toText());  // 0</span>
<span class="nc" id="L428">            addTextField (this, &quot;Hex laid&quot;,</span>
<span class="nc" id="L429">                    action.getChosenHex(),</span>
<span class="nc" id="L430">                    action.getChosenHex().getId());  // 1</span>
<span class="nc" id="L431">            addTextField (this, &quot;Orientation&quot;,</span>
<span class="nc" id="L432">                    action.getOrientation(),</span>
<span class="nc" id="L433">                    String.valueOf(action.getOrientation()));  // 2</span>
<span class="nc" id="L434">            finish();</span>
<span class="nc" id="L435">        }</span>

        @Override
        PossibleAction processInput() {
<span class="nc" id="L439">            log.debug(&quot;Action was {}&quot;, action);</span>
            try {
<span class="nc" id="L441">                String tileID = ((JTextField)inputElements.get(0)).getText();</span>
<span class="nc" id="L442">                Tile tile = root.getTileManager().getTile(tileID);</span>
<span class="nc bnc" id="L443" title="All 2 branches missed.">                if (tile != null) action.setLaidTile(tile);</span>
<span class="nc" id="L444">            } catch (NumberFormatException e) {</span>
<span class="nc" id="L445">            }</span>
<span class="nc" id="L446">            String hexID = ((JTextField)inputElements.get(1)).getText();</span>
<span class="nc" id="L447">            MapHex hex = root.getMapManager().getHex(hexID);</span>
<span class="nc bnc" id="L448" title="All 4 branches missed.">            if (hexID != null &amp;&amp; hex != null) action.setChosenHex(hex);</span>
            try {
<span class="nc" id="L450">                int orientation = Integer.parseInt(((JTextField)inputElements.get(2)).getText());</span>
<span class="nc" id="L451">                action.setOrientation(orientation);</span>
<span class="nc" id="L452">            } catch (NumberFormatException e) {</span>
<span class="nc" id="L453">            }</span>

<span class="nc" id="L455">            log.debug(&quot;Action is {}&quot;, action);</span>
<span class="nc" id="L456">            return action;</span>

        }
    }

    protected void addLabel (EditDialog owner, String caption, Object initialObject, String initialValue) {
<span class="nc" id="L462">        JComponent element = new JLabel (initialValue);</span>
<span class="nc" id="L463">        int index = owner.length++;</span>
<span class="nc" id="L464">        addField (owner, new JLabel (caption), index, 0);</span>
<span class="nc" id="L465">        addField (owner, element, index, 1);</span>
<span class="nc" id="L466">        owner.originalValues.add(initialObject);</span>
<span class="nc" id="L467">        owner.inputElements.add(element);</span>
<span class="nc" id="L468">    }</span>

    protected void addTextField (EditDialog owner, String caption, Object initialObject, String initialValue) {
<span class="nc" id="L471">        JComponent element = new JTextField (initialValue);</span>
<span class="nc" id="L472">        int index = owner.length++;</span>
<span class="nc" id="L473">        addField (owner, new JLabel (caption), index, 0);</span>
<span class="nc" id="L474">        addField (owner, element, index, 1);</span>
<span class="nc" id="L475">        owner.originalValues.add(initialObject);</span>
<span class="nc" id="L476">        owner.inputElements.add(element);</span>
<span class="nc" id="L477">    }</span>

    protected void addField(EditDialog owner, JComponent comp, int y, int x) {
<span class="nc" id="L480">        GridBagConstraints gbc = owner.gc;</span>
<span class="nc" id="L481">        gbc.gridx = x;</span>
<span class="nc" id="L482">        gbc.gridy = y;</span>
<span class="nc" id="L483">        gbc.gridwidth = 1;</span>
<span class="nc" id="L484">        gbc.gridheight = 1;</span>
<span class="nc" id="L485">        gbc.weightx = gbc.weighty = 0.5;</span>
<span class="nc" id="L486">        gbc.fill = GridBagConstraints.BOTH;</span>

<span class="nc" id="L488">        owner.getContentPane().add(comp, gbc);</span>

<span class="nc" id="L490">        comp.setVisible(true);</span>
<span class="nc" id="L491">    }</span>

<span class="nc" id="L493">    public void keyPressed(KeyEvent e) { }</span>

<span class="nc" id="L495">    public void keyReleased(KeyEvent e) {}</span>

<span class="nc" id="L497">    public void keyTyped(KeyEvent e) {}</span>


}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>