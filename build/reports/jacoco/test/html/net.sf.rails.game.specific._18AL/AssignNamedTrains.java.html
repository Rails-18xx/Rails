<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="de"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AssignNamedTrains.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Rails</a> &gt; <a href="index.source.html" class="el_package">net.sf.rails.game.specific._18AL</a> &gt; <span class="el_source">AssignNamedTrains.java</span></div><h1>AssignNamedTrains.java</h1><pre class="source lang-java linenums">package net.sf.rails.game.specific._18AL;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.util.ArrayList;
import java.util.List;
import java.util.Set;

import com.google.common.base.Objects;

import net.sf.rails.game.RailsRoot;
import net.sf.rails.game.Train;
import net.sf.rails.game.TrainManager;
import net.sf.rails.util.RailsObjects;
import rails.game.action.PossibleAction;
import rails.game.action.UseSpecialProperty;


/**
 * Rails 2.0: Updated equals and toString methods
 */
// TODO: Rails 2.0 This seems a pretty complicated action. Is this really required for the task?
public class AssignNamedTrains extends UseSpecialProperty {

    transient private List&lt;NameableTrain&gt; nameableTrains;
    private String[] trainIds;
    private int numberOfTrains;
    private int numberOfTokens;

    transient private List&lt;NameableTrain&gt; preTrainPerToken;
    private String[] preTrainds;

    transient private List&lt;NameableTrain&gt; postTrainPerToken;
    private String[] postTrainds;

    public static final long serialVersionUID = 1L;

    public AssignNamedTrains(NameTrains namedTrainsSpecialProperty,
            Set&lt;Train&gt; trains) {
<span class="nc" id="L40">        super(namedTrainsSpecialProperty);</span>

<span class="nc" id="L42">        numberOfTrains = trains.size();</span>
<span class="nc" id="L43">        List&lt;NamedTrainToken&gt; tokens = namedTrainsSpecialProperty.getTokens();</span>
<span class="nc" id="L44">        numberOfTokens = tokens.size();</span>

<span class="nc" id="L46">        nameableTrains = new ArrayList&lt;NameableTrain&gt;(numberOfTrains);</span>
<span class="nc bnc" id="L47" title="All 2 branches missed.">        for (Train train : trains) {</span>
<span class="nc" id="L48">            nameableTrains.add((NameableTrain) train);</span>
<span class="nc" id="L49">        }</span>
<span class="nc" id="L50">        preTrainPerToken = new ArrayList&lt;NameableTrain&gt;(numberOfTokens);</span>
<span class="nc" id="L51">        postTrainPerToken = new ArrayList&lt;NameableTrain&gt;(numberOfTokens);</span>

<span class="nc" id="L53">        trainIds = new String[numberOfTrains];</span>
<span class="nc" id="L54">        preTrainds = new String[numberOfTokens];</span>
<span class="nc" id="L55">        postTrainds = new String[numberOfTokens];</span>

<span class="nc bnc" id="L57" title="All 2 branches missed.">        for (int i = 0; i &lt; numberOfTokens; i++) {</span>
<span class="nc" id="L58">            preTrainPerToken.add(null);</span>
        }

<span class="nc bnc" id="L61" title="All 2 branches missed.">        if (trains != null) {</span>
<span class="nc" id="L62">            int trainIndex = 0;</span>
            int tokenIndex;
<span class="nc bnc" id="L64" title="All 2 branches missed.">            for (NameableTrain train : nameableTrains) {</span>
<span class="nc" id="L65">                trainIds[trainIndex] = train.getId();</span>
<span class="nc" id="L66">                NamedTrainToken token = train.getNameToken();</span>
<span class="nc bnc" id="L67" title="All 2 branches missed.">                if (token != null) {</span>
<span class="nc" id="L68">                    preTrainPerToken.set(tokens.indexOf(token), train);</span>
<span class="nc" id="L69">                    tokenIndex = tokens.indexOf(token);</span>
<span class="nc" id="L70">                    preTrainds[tokenIndex] = train.getId();</span>
                }
<span class="nc" id="L72">                trainIndex++;</span>
<span class="nc" id="L73">            }</span>
        }
<span class="nc" id="L75">    }</span>

    @Override
    public String toMenu() {
<span class="nc" id="L79">        return ((NameTrains) specialProperty).toMenu();</span>
    }

    public List&lt;NamedTrainToken&gt; getTokens() {
<span class="nc" id="L83">        return ((NameTrains) specialProperty).getTokens();</span>
    }

    public List&lt;NameableTrain&gt; getNameableTrains() {
<span class="nc" id="L87">        return nameableTrains;</span>
    }

    public List&lt;NameableTrain&gt; getPreTrainPerToken() {
<span class="nc" id="L91">        return preTrainPerToken;</span>
    }

    public List&lt;NameableTrain&gt; getPostTrainPerToken() {
<span class="nc" id="L95">        return postTrainPerToken;</span>
    }

    public void setPostTrainPerToken(List&lt;NameableTrain&gt; postTokensPerTrain) {
<span class="nc" id="L99">        this.postTrainPerToken = postTokensPerTrain;</span>
        // convert to postTrainds
<span class="nc bnc" id="L101" title="All 2 branches missed.">        if (postTokensPerTrain != null) {</span>
<span class="nc bnc" id="L102" title="All 2 branches missed.">            for (NameableTrain train : postTokensPerTrain) {</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">                if (train == null) {</span>
<span class="nc" id="L104">                    postTrainds[postTokensPerTrain.indexOf(train)] = null;</span>
                } else {
<span class="nc" id="L106">                    postTrainds[postTokensPerTrain.indexOf(train)] = train.getId();</span>
                }
<span class="nc" id="L108">            }</span>
        }
<span class="nc" id="L110">    }</span>

    @Override
    protected boolean equalsAs(PossibleAction pa, boolean asOption) {
        // identity always true
<span class="nc bnc" id="L115" title="All 2 branches missed.">        if (pa == this) return true;</span>
        //  super checks both class identity and super class attributes
<span class="nc bnc" id="L117" title="All 2 branches missed.">        if (!super.equalsAs(pa, asOption)) return false;</span>

        // check asOption attributes
<span class="nc" id="L120">        AssignNamedTrains action = (AssignNamedTrains)pa;</span>
<span class="nc" id="L121">        boolean options =</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">                Objects.equal(this.nameableTrains, action.nameableTrains)</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">                &amp;&amp; Objects.equal(this.preTrainPerToken, action.preTrainPerToken)</span>
        ;

        // finish if asOptions check
<span class="nc bnc" id="L127" title="All 2 branches missed.">        if (asOption) return options;</span>

        // check asAction attributes
<span class="nc bnc" id="L130" title="All 2 branches missed.">        return options</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">                &amp;&amp; Objects.equal(this.postTrainPerToken, action.postTrainPerToken)</span>
        ;
    }
    @Override
    public String toString() {
<span class="nc" id="L136">        return super.toString() +</span>
<span class="nc" id="L137">                RailsObjects.stringHelper(this)</span>
<span class="nc" id="L138">                    .addToString(&quot;nameableTrains&quot;, nameableTrains)</span>
<span class="nc" id="L139">                    .addToString(&quot;preTrainPerToken&quot;, preTrainPerToken)</span>
<span class="nc" id="L140">                    .addToStringOnlyActed(&quot;postTrainPerToken&quot;, postTrainPerToken)</span>
<span class="nc" id="L141">                    .toString()</span>
        ;
    }

    /** Deserialize */
    private void readObject(ObjectInputStream in) throws IOException,
            ClassNotFoundException {

<span class="nc" id="L149">        in.defaultReadObject();</span>

<span class="nc" id="L151">        TrainManager trainManager = RailsRoot.getInstance().getTrainManager();</span>

<span class="nc" id="L153">        nameableTrains = new ArrayList&lt;NameableTrain&gt;();</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">        if (trainIds != null) {</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">            for (String trainId : trainIds) {</span>
<span class="nc" id="L156">                nameableTrains.add((NameableTrain) trainManager.getTrainByUniqueId(trainId));</span>
            }
        }

<span class="nc" id="L160">        preTrainPerToken = new ArrayList&lt;NameableTrain&gt;(numberOfTrains);</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">        if (preTrainds != null) {</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">            for (String trainId : preTrainds) {</span>
<span class="nc bnc" id="L163" title="All 4 branches missed.">                if (trainId != null &amp;&amp; trainId.length() &gt; 0) {</span>
//                    preTrainPerToken.add((NameableTrain) Token.getByUniqueId(trainId));
<span class="nc" id="L165">                  preTrainPerToken.add((NameableTrain) trainManager.getTrainByUniqueId(trainId));</span>
                } else {
<span class="nc" id="L167">                    preTrainPerToken.add(null);</span>
                }
            }
        }

<span class="nc" id="L172">        postTrainPerToken = new ArrayList&lt;NameableTrain&gt;(numberOfTrains);</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">        if (postTrainds != null) {</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">            for (String trainId : postTrainds) {</span>
<span class="nc bnc" id="L175" title="All 4 branches missed.">                if (trainId != null &amp;&amp; trainId.length() &gt; 0) {</span>
//                    postTrainPerToken.add((NameableTrain) Token.getByUniqueId(trainId));
<span class="nc" id="L177">                    postTrainPerToken.add((NameableTrain) trainManager.getTrainByUniqueId(trainId));</span>
                } else {
<span class="nc" id="L179">                    postTrainPerToken.add(null);</span>
                }
            }
        }

<span class="nc" id="L184">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>