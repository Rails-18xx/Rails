<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="de"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>StartRoundWindow.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Rails</a> &gt; <a href="index.source.html" class="el_package">net.sf.rails.ui.swing</a> &gt; <span class="el_source">StartRoundWindow.java</span></div><h1>StartRoundWindow.java</h1><pre class="source lang-java linenums">package net.sf.rails.ui.swing;

import java.awt.*;
import java.awt.event.*;
import java.util.EnumSet;
import java.util.List;
import java.util.SortedSet;
import java.util.TreeSet;

import javax.swing.*;

import net.sf.rails.common.LocalText;
import net.sf.rails.game.*;
import net.sf.rails.game.financial.Bank;
import net.sf.rails.game.financial.StockMarket;
import net.sf.rails.game.financial.StockSpace;
import net.sf.rails.game.round.RoundFacade;
import net.sf.rails.game.special.SpecialProperty;
import net.sf.rails.sound.SoundManager;
import net.sf.rails.ui.swing.elements.*;
import net.sf.rails.ui.swing.hexmap.HexHighlightMouseListener;
import net.sf.rails.util.Util;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import rails.game.action.*;

import com.google.common.collect.Iterables;


/**
 * This displays the Auction Window
 */
<span class="nc" id="L35">public class StartRoundWindow extends JFrame implements ActionListener, KeyListener, ActionPerformer, DialogOwner {</span>

    private static final long serialVersionUID = 1L;

    // Gap sizes between screen cells, in pixels
    private static final int NARROW_GAP = 1;
    private static final int WIDE_GAP = 3;
    // Bits for specifying where to apply wide gaps
    private static final int WIDE_LEFT = 1;
    private static final int WIDE_RIGHT = 2;
    private static final int WIDE_TOP = 4;
    private static final int WIDE_BOTTOM = 8;

<span class="fc" id="L48">    private static final Color buyableColour = new Color (0, 128, 0);</span>
<span class="fc" id="L49">    private static final Color soldColour = new Color (128, 128, 128);</span>
<span class="fc" id="L50">    private static final Color defaultColour = Color.BLACK;</span>

    private JPanel statusPanel;
    private JPanel buttonPanel;

    private GridBagLayout gb;
    private GridBagConstraints gbc;

    // Grid elements per function
    private Caption itemName[];
    private ClickField itemNameButton[];
    private int itemNameXOffset, itemNameYOffset;
    private Field basePrice[];
    private int basePriceXOffset, basePriceYOffset;
    private Field minBid[];
    private int minBidXOffset, minBidYOffset;
    private Field bidPerPlayer[][];
    private int bidPerPlayerXOffset, bidPerPlayerYOffset;
    private Field playerBids[];
    private int playerBidsXOffset, playerBidsYOffset;
    private Field playerFree[];
    private int playerFreeCashXOffset, playerFreeCashYOffset;
    private Field info[];
    private int infoXOffset, infoYOffset;
    private Field itemStatus[]; // Remains invisible, only used for status tooltip

    private int playerCaptionXOffset, upperPlayerCaptionYOffset, lowerPlayerCaptionYOffset;
    private Field upperPlayerCaption[];
    private Field lowerPlayerCaption[];
    private JComponent[][] fields;

    private ActionButton bidButton;
    private ActionButton buyButton;
    private JSpinner bidAmount;
    private SpinnerNumberModel spinnerModel;
    private ActionButton passButton;

<span class="nc" id="L87">    private ImageIcon infoIcon = null;</span>

    private int np; // Number of players
    private int ni; // Number of start items
    private Player[] players;
    private StartItem[] items;
    private StartItemAction[] actionableItems;
    private StartPacket packet;
    private int[] crossIndex;
    protected StartRound round;
    private GameUIManager gameUIManager;

    // For the non-modal dialog to ask for a company starting share price.
<span class="nc" id="L100">    protected JDialog currentDialog = null;</span>
<span class="nc" id="L101">    protected PossibleAction currentDialogAction = null;</span>
<span class="nc" id="L102">    protected SortedSet&lt;StockSpace&gt; startSpaces = null;</span>

    private StartItem si;
    private JComponent f;

    /** @see StartItem.statusName */
<span class="fc" id="L108">    protected static final String[] itemStatusTextKeys =</span>
        new String[] { &quot;Status_Unavailable&quot;, &quot;Status_Biddable&quot;, &quot;Status_Buyable&quot;,
        &quot;Status_Selectable&quot;, &quot;Status_Auctioned&quot;,
        &quot;Status_NeedingSharePrice&quot;, &quot;Status_Sold&quot; };

    // Current state
<span class="nc" id="L114">    private int playerIndex = -1;</span>

    protected PossibleActions possibleActions;
<span class="nc" id="L117">    protected PossibleAction immediateAction = null;</span>

<span class="nc" id="L119">    private final ButtonGroup itemGroup = new ButtonGroup();</span>
    private ClickField dummyButton; // To be selected if none else is.

    private boolean includeBidding;
    private boolean includeBuying;
    private boolean showBasePrices;

    /* Keys of dialogs owned by this class */
    public static final String COMPANY_START_PRICE_DIALOG = &quot;CompanyStartPrice&quot;;

<span class="fc" id="L129">    private static final Logger log = LoggerFactory.getLogger(StartRoundWindow.class);</span>

    public void init(StartRound round, GameUIManager parent) {
        //super();
<span class="nc" id="L133">        this.round = round;</span>
<span class="nc" id="L134">        includeBidding = round.hasBidding();</span>
<span class="nc" id="L135">        includeBuying = round.hasBuying();</span>
<span class="nc" id="L136">        showBasePrices = round.hasBasePrices();</span>
<span class="nc" id="L137">        gameUIManager = parent;</span>
<span class="nc" id="L138">        possibleActions = gameUIManager.getGameManager().getPossibleActions();</span>

<span class="nc" id="L140">        setTitle(LocalText.getText(&quot;START_ROUND_TITLE&quot;));</span>
<span class="nc" id="L141">        getContentPane().setLayout(new BorderLayout());</span>

<span class="nc" id="L143">        statusPanel = new JPanel();</span>
<span class="nc" id="L144">        gb = new GridBagLayout();</span>
<span class="nc" id="L145">        statusPanel.setLayout(gb);</span>
<span class="nc" id="L146">        statusPanel.setBorder(BorderFactory.createEtchedBorder());</span>
<span class="nc" id="L147">        statusPanel.setOpaque(true);</span>

<span class="nc" id="L149">        buttonPanel = new JPanel();</span>

<span class="nc bnc" id="L151" title="All 2 branches missed.">        if (includeBuying) {</span>
<span class="nc" id="L152">            buyButton = new ActionButton(RailsIcon.AUCTION_BUY);</span>
<span class="nc" id="L153">            buyButton.setMnemonic(KeyEvent.VK_B);</span>
<span class="nc" id="L154">            buyButton.addActionListener(this);</span>
<span class="nc" id="L155">            buyButton.setEnabled(false);</span>
<span class="nc" id="L156">            buttonPanel.add(buyButton);</span>
        }

<span class="nc bnc" id="L159" title="All 2 branches missed.">        if (includeBidding) {</span>
<span class="nc" id="L160">            bidButton = new ActionButton(RailsIcon.BID);</span>
<span class="nc" id="L161">            bidButton.setMnemonic(KeyEvent.VK_D);</span>
<span class="nc" id="L162">            bidButton.addActionListener(this);</span>
<span class="nc" id="L163">            bidButton.setEnabled(false);</span>
<span class="nc" id="L164">            buttonPanel.add(bidButton);</span>

<span class="nc" id="L166">            spinnerModel =</span>
<span class="nc" id="L167">                new SpinnerNumberModel(999, 0, null, 1);</span>
<span class="nc" id="L168">            bidAmount = new JSpinner(spinnerModel);</span>
<span class="nc" id="L169">            bidAmount.setPreferredSize(new Dimension(50, 28));</span>
<span class="nc" id="L170">            bidAmount.setEnabled(false);</span>
<span class="nc" id="L171">            buttonPanel.add(bidAmount);</span>
        }

<span class="nc" id="L174">        passButton = new ActionButton(RailsIcon.PASS);</span>
<span class="nc" id="L175">        passButton.setMnemonic(KeyEvent.VK_P);</span>
<span class="nc" id="L176">        passButton.addActionListener(this);</span>
<span class="nc" id="L177">        passButton.setEnabled(false);</span>
<span class="nc" id="L178">        buttonPanel.add(passButton);</span>

<span class="nc" id="L180">        buttonPanel.setOpaque(true);</span>

<span class="nc" id="L182">        gbc = new GridBagConstraints();</span>

<span class="nc" id="L184">        players = gameUIManager.getRoot().getPlayerManager().getPlayers().toArray(new Player[0]);</span>
<span class="nc" id="L185">        np = gameUIManager.getRoot().getPlayerManager().getNumberOfPlayers();</span>
<span class="nc" id="L186">        packet = round.getStartPacket();</span>
<span class="nc" id="L187">        crossIndex = new int[packet.getNumberOfItems()];</span>

<span class="nc" id="L189">        items = round.getStartItems().toArray(new StartItem[0]);</span>
<span class="nc" id="L190">        ni = items.length;</span>
        StartItem item;
<span class="nc bnc" id="L192" title="All 2 branches missed.">        for (int i = 0; i &lt; ni; i++) {</span>
<span class="nc" id="L193">            item = items[i];</span>
<span class="nc" id="L194">            crossIndex[item.getIndex()] = i;</span>
        }

<span class="nc" id="L197">        actionableItems = new StartItemAction[ni];</span>

<span class="nc" id="L199">        infoIcon = createInfoIcon();</span>

<span class="nc" id="L201">        initCells();</span>

<span class="nc" id="L203">        getContentPane().add(statusPanel, BorderLayout.NORTH);</span>
<span class="nc" id="L204">        getContentPane().add(buttonPanel, BorderLayout.SOUTH);</span>
<span class="nc" id="L205">        setTitle(&quot;Rails: Start Round&quot;);</span>
<span class="nc" id="L206">        setLocation(300, 150);</span>
<span class="nc" id="L207">        setSize(275, 325);</span>
<span class="nc" id="L208">        gameUIManager.setMeVisible(this, true);</span>
<span class="nc" id="L209">        requestFocus();</span>

<span class="nc" id="L211">        addKeyListener(this);</span>

        // set closing behavior and listener
<span class="nc" id="L214">        setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE );</span>
<span class="nc" id="L215">        final JFrame thisFrame = this;</span>
<span class="nc" id="L216">        final GameUIManager guiMgr = gameUIManager;</span>
<span class="nc" id="L217">        addWindowListener(new WindowAdapter () {</span>
            @Override
            public void windowClosing(WindowEvent e) {
<span class="nc bnc" id="L220" title="All 2 branches missed.">                if (JOptionPane.showConfirmDialog(thisFrame, LocalText.getText(&quot;CLOSE_WINDOW&quot;), LocalText.getText(&quot;Select&quot;), JOptionPane.OK_CANCEL_OPTION)</span>
                        == JOptionPane.OK_OPTION) {
<span class="nc" id="L222">                    thisFrame.dispose();</span>
<span class="nc" id="L223">                    guiMgr.terminate();</span>
                }
<span class="nc" id="L225">            }</span>
        });
<span class="nc" id="L227">        addComponentListener(new ComponentAdapter() {</span>
            @Override
            public void componentMoved(ComponentEvent e) {
<span class="nc" id="L230">                guiMgr.getWindowSettings().set(thisFrame);</span>
<span class="nc" id="L231">            }</span>
            @Override
            public void componentResized(ComponentEvent e) {
<span class="nc" id="L234">                guiMgr.getWindowSettings().set(thisFrame);</span>
<span class="nc" id="L235">            }</span>
        });

<span class="nc" id="L238">        gameUIManager.packAndApplySizing(this);</span>
<span class="nc" id="L239">    }</span>

    private void initCells() {
<span class="nc" id="L242">        int lastX = -1;</span>
<span class="nc" id="L243">        int lastY = 0;</span>

<span class="nc" id="L245">        itemName = new Caption[ni];</span>
<span class="nc" id="L246">        itemNameButton = new ClickField[ni];</span>
<span class="nc" id="L247">        basePrice = new Field[ni];</span>
<span class="nc" id="L248">        minBid = new Field[ni];</span>
<span class="nc" id="L249">        bidPerPlayer = new Field[ni][np];</span>
<span class="nc" id="L250">        info = new Field[ni];</span>
<span class="nc" id="L251">        itemStatus = new Field[ni];</span>
<span class="nc" id="L252">        upperPlayerCaption = new Field[np];</span>
<span class="nc" id="L253">        lowerPlayerCaption = new Field[np];</span>
<span class="nc" id="L254">        playerBids = new Field[np];</span>
<span class="nc" id="L255">        playerFree = new Field[np];</span>

<span class="nc" id="L257">        upperPlayerCaptionYOffset = ++lastY;</span>

<span class="nc" id="L259">        itemNameXOffset = ++lastX;</span>
<span class="nc" id="L260">        itemNameYOffset = ++lastY;</span>
<span class="nc bnc" id="L261" title="All 2 branches missed.">        if (showBasePrices) {</span>
<span class="nc" id="L262">            basePriceXOffset = ++lastX;</span>
<span class="nc" id="L263">            basePriceYOffset = lastY;</span>
        }
<span class="nc bnc" id="L265" title="All 2 branches missed.">        if (includeBidding) {</span>
<span class="nc" id="L266">            minBidXOffset = ++lastX;</span>
<span class="nc" id="L267">            minBidYOffset = lastY;</span>
        }
<span class="nc" id="L269">        bidPerPlayerXOffset = playerCaptionXOffset = ++lastX;</span>
<span class="nc" id="L270">        bidPerPlayerYOffset = lastY;</span>

<span class="nc" id="L272">        infoXOffset = bidPerPlayerXOffset + np;</span>
<span class="nc" id="L273">        infoYOffset = lastY;</span>

        // Bottom rows
<span class="nc" id="L276">        lastY += (ni - 1);</span>
<span class="nc bnc" id="L277" title="All 2 branches missed.">        if (includeBidding) {</span>
<span class="nc" id="L278">            playerBidsXOffset = bidPerPlayerXOffset;</span>
<span class="nc" id="L279">            playerBidsYOffset = ++lastY;</span>
        }
<span class="nc" id="L281">        playerFreeCashXOffset = bidPerPlayerXOffset;</span>
<span class="nc" id="L282">        playerFreeCashYOffset = ++lastY;</span>

<span class="nc" id="L284">        lowerPlayerCaptionYOffset = ++lastY;</span>

<span class="nc" id="L286">        fields = new JComponent[1+infoXOffset] [2+lastY];</span>

<span class="nc" id="L288">        addField(new Caption(LocalText.getText(&quot;ITEM&quot;)), 0, 0, 1, 2,</span>
                WIDE_RIGHT + WIDE_BOTTOM);
<span class="nc bnc" id="L290" title="All 2 branches missed.">        if (showBasePrices) {</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">            addField(new Caption(LocalText.getText(includeBidding</span>
<span class="nc" id="L292">                    ? &quot;BASE_PRICE&quot; : &quot;PRICE&quot;)), basePriceXOffset, 0, 1, 2,</span>
                    WIDE_BOTTOM);
        }
<span class="nc bnc" id="L295" title="All 2 branches missed.">        if (includeBidding) {</span>
<span class="nc" id="L296">            addField(new Caption(LocalText.getText(&quot;MINIMUM_BID&quot;)),</span>
                    minBidXOffset, 0, 1, 2, WIDE_BOTTOM + WIDE_RIGHT);
        }
<span class="nc" id="L299">        addField(new Caption(LocalText.getText(&quot;PLAYERS&quot;)),</span>
                playerCaptionXOffset, 0, np, 1, 0);
<span class="nc bnc" id="L301" title="All 2 branches missed.">        for (int i = 0; i &lt; np; i++) {</span>
<span class="nc" id="L302">            f = upperPlayerCaption[i] = new Field(players[i].getPlayerNameModel());</span>
<span class="nc" id="L303">            addField(f, playerCaptionXOffset + i, upperPlayerCaptionYOffset, 1, 1, WIDE_BOTTOM);</span>
        }

<span class="nc bnc" id="L306" title="All 2 branches missed.">        for (int i = 0; i &lt; ni; i++) {</span>
<span class="nc" id="L307">            si = items[i];</span>
<span class="nc" id="L308">            f = itemName[i] = new Caption(si.getId());</span>
<span class="nc" id="L309">            HexHighlightMouseListener.addMouseListener(f,</span>
<span class="nc" id="L310">                    gameUIManager.getORUIManager(),</span>
                    si);
<span class="nc" id="L312">            addField(f, itemNameXOffset, itemNameYOffset + i, 1, 1, WIDE_RIGHT);</span>
<span class="nc" id="L313">            f =</span>
                itemNameButton[i] =
<span class="nc" id="L315">                    new ClickField(si.getId(), &quot;&quot;, &quot;&quot;, this,</span>
                            itemGroup);
<span class="nc" id="L317">            HexHighlightMouseListener.addMouseListener(f,</span>
<span class="nc" id="L318">                    gameUIManager.getORUIManager(),</span>
                    si);
<span class="nc" id="L320">            addField(f, itemNameXOffset, itemNameYOffset + i, 1, 1, WIDE_RIGHT);</span>
            // Prevent row height resizing after every buy action
<span class="nc" id="L322">            itemName[i].setPreferredSize(itemNameButton[i].getPreferredSize());</span>

<span class="nc bnc" id="L324" title="All 2 branches missed.">            if (showBasePrices) {</span>
<span class="nc" id="L325">                f = basePrice[i] = new Field(si.getBasePriceModel());</span>
<span class="nc" id="L326">                addField(f, basePriceXOffset, basePriceYOffset + i, 1, 1, 0);</span>
            }

<span class="nc bnc" id="L329" title="All 2 branches missed.">            if (includeBidding) {</span>
<span class="nc" id="L330">                f = minBid[i] = new Field(round.getMinimumBidModel(i));</span>
<span class="nc" id="L331">                addField(f, minBidXOffset, minBidYOffset + i, 1, 1, WIDE_RIGHT);</span>
            }

<span class="nc bnc" id="L334" title="All 2 branches missed.">            for (int j = 0; j &lt; np; j++) {</span>
<span class="nc" id="L335">                f = bidPerPlayer[i][j] = new Field(round.getBidModel(i, players[j]));</span>
<span class="nc" id="L336">                addField(f, bidPerPlayerXOffset + j, bidPerPlayerYOffset + i,</span>
                        1, 1, 0);
            }

<span class="nc" id="L340">            f = info[i] = new Field (infoIcon);</span>
<span class="nc" id="L341">            f.setToolTipText(getStartItemDescription(si));</span>
<span class="nc" id="L342">            HexHighlightMouseListener.addMouseListener(f,</span>
<span class="nc" id="L343">                    gameUIManager.getORUIManager(),</span>
                    si);
<span class="nc" id="L345">            addField (f, infoXOffset, infoYOffset + i, 1, 1, WIDE_LEFT);</span>

            // Invisible field, only used to hold current item status.
<span class="nc" id="L348">            f = itemStatus[i] = new Field (si.getStatusModel());</span>
        }

        // Player money
<span class="nc" id="L352">        boolean firstBelowTable = true;</span>
<span class="nc bnc" id="L353" title="All 2 branches missed.">        if (includeBidding) {</span>
<span class="nc" id="L354">            addField(new Caption(LocalText.getText(&quot;BID&quot;)),</span>
                    playerBidsXOffset - 1, playerBidsYOffset, 1, 1,
                    WIDE_TOP + WIDE_RIGHT);
<span class="nc bnc" id="L357" title="All 2 branches missed.">            for (int i = 0; i &lt; np; i++) {</span>
<span class="nc" id="L358">                f = playerBids[i] = new Field(round.getBlockedCashModel(players[i]));</span>
<span class="nc" id="L359">                addField(f, playerBidsXOffset + i, playerBidsYOffset, 1, 1,</span>
                        WIDE_TOP);
            }
<span class="nc" id="L362">            firstBelowTable = false;</span>
        }

<span class="nc" id="L365">        addField(new Caption(</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">                LocalText.getText(includeBidding ? &quot;FREE&quot; : &quot;CASH&quot;)),</span>
                playerFreeCashXOffset - 1, playerFreeCashYOffset, 1, 1,
<span class="nc bnc" id="L368" title="All 2 branches missed.">                WIDE_RIGHT + (firstBelowTable ? WIDE_TOP : 0));</span>
<span class="nc bnc" id="L369" title="All 2 branches missed.">        for (int i = 0; i &lt; np; i++) {</span>
<span class="nc" id="L370">            f =</span>
                playerFree[i] =
<span class="nc bnc" id="L372" title="All 2 branches missed.">                    new Field(includeBidding</span>
<span class="nc" id="L373">                            ? round.getFreeCashModel(players[i])</span>
<span class="nc" id="L374">                                    : players[i].getWallet());</span>
<span class="nc" id="L375">            addField(f, playerFreeCashXOffset + i, playerFreeCashYOffset, 1, 1,</span>
<span class="nc bnc" id="L376" title="All 2 branches missed.">                    firstBelowTable ? WIDE_TOP : 0);</span>
        }

<span class="nc bnc" id="L379" title="All 2 branches missed.">        for (int i = 0; i &lt; np; i++) {</span>
<span class="nc" id="L380">            f = lowerPlayerCaption[i] = new Field(players[i].getPlayerNameModel());</span>
<span class="nc" id="L381">            addField(f, playerFreeCashXOffset + i, playerFreeCashYOffset + 1,</span>
                    1, 1, WIDE_TOP);
        }

<span class="nc" id="L385">        dummyButton = new ClickField(&quot;&quot;, &quot;&quot;, &quot;&quot;, this, itemGroup);</span>

<span class="nc" id="L387">    }</span>

    private void addField(JComponent comp, int x, int y, int width, int height,
            int wideGapPositions) {

        int padTop, padLeft, padBottom, padRight;
<span class="nc" id="L393">        gbc.gridx = x;</span>
<span class="nc" id="L394">        gbc.gridy = y;</span>
<span class="nc" id="L395">        gbc.gridwidth = width;</span>
<span class="nc" id="L396">        gbc.gridheight = height;</span>
<span class="nc" id="L397">        gbc.weightx = gbc.weighty = 0.5;</span>
<span class="nc" id="L398">        gbc.fill = GridBagConstraints.BOTH;</span>
<span class="nc bnc" id="L399" title="All 2 branches missed.">        padTop = (wideGapPositions &amp; WIDE_TOP) &gt; 0 ? WIDE_GAP : NARROW_GAP;</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">        padLeft = (wideGapPositions &amp; WIDE_LEFT) &gt; 0 ? WIDE_GAP : NARROW_GAP;</span>
        padBottom =
<span class="nc bnc" id="L402" title="All 2 branches missed.">            (wideGapPositions &amp; WIDE_BOTTOM) &gt; 0 ? WIDE_GAP : NARROW_GAP;</span>
<span class="nc bnc" id="L403" title="All 2 branches missed.">            padRight = (wideGapPositions &amp; WIDE_RIGHT) &gt; 0 ? WIDE_GAP : NARROW_GAP;</span>
<span class="nc" id="L404">            gbc.insets = new Insets(padTop, padLeft, padBottom, padRight);</span>

<span class="nc" id="L406">            statusPanel.add(comp, gbc);</span>
<span class="nc" id="L407">            fields[x][y] = comp;</span>

<span class="nc" id="L409">    }</span>

    public void updateStatus(boolean myTurn) {
        StartItem item;
        int i, j;

<span class="nc bnc" id="L415" title="All 2 branches missed.">        for (i = 0; i &lt; ni; i++) {</span>
<span class="nc" id="L416">            setItemNameButton(i, false);</span>
<span class="nc" id="L417">            actionableItems[i] = null;</span>
        }
        // Unselect the selected private
<span class="nc" id="L420">        dummyButton.setSelected(true);</span>

<span class="nc" id="L422">        buyButton.setEnabled(false);</span>
<span class="nc" id="L423">        bidButton.setEnabled(false);</span>
<span class="nc" id="L424">        bidAmount.setEnabled(false);</span>
<span class="nc" id="L425">        passButton.setEnabled(false);</span>

<span class="nc" id="L427">        RoundFacade currentRound = gameUIManager.getCurrentRound();</span>
<span class="nc bnc" id="L428" title="All 2 branches missed.">        if (!(currentRound instanceof StartRound)) {</span>
<span class="nc" id="L429">            log.debug(&quot;early return: {}&quot;, currentRound);</span>
<span class="nc" id="L430">            return;</span>
        }

<span class="nc bnc" id="L433" title="All 2 branches missed.">        if (!myTurn) return;</span>

        // For debugging
<span class="nc bnc" id="L436" title="All 2 branches missed.">        for (PossibleAction action : possibleActions.getList()) {</span>
<span class="nc" id="L437">            log.debug(&quot;{} may: {}&quot;, action.getPlayerName(), action);</span>
<span class="nc" id="L438">        }</span>

<span class="nc" id="L440">        List&lt;StartItemAction&gt; actions = possibleActions.getType(StartItemAction.class);</span>

<span class="nc bnc" id="L442" title="All 4 branches missed.">        if (actions == null || actions.isEmpty()) {</span>
<span class="nc" id="L443">            close();</span>
<span class="nc" id="L444">            return;</span>
        }

<span class="nc" id="L447">        int nextPlayerIndex = ((PossibleAction) actions.get(0)).getPlayerIndex();</span>
<span class="nc" id="L448">        setSRPlayerTurn(nextPlayerIndex);</span>

<span class="nc" id="L450">        boolean buyAllowed = false;</span>
<span class="nc" id="L451">        boolean bidAllowed = false;</span>

<span class="nc" id="L453">        boolean selected = false;</span>

        BuyStartItem buyAction;

<span class="nc bnc" id="L457" title="All 2 branches missed.">        for (StartItemAction action : actions) {</span>
<span class="nc" id="L458">            j = action.getItemIndex();</span>
<span class="nc" id="L459">            i = crossIndex[j];</span>
<span class="nc" id="L460">            actionableItems[i] = action;</span>
<span class="nc" id="L461">            item = action.getStartItem();</span>

<span class="nc bnc" id="L463" title="All 2 branches missed.">            if (action instanceof BuyStartItem) {</span>
<span class="nc" id="L464">                buyAction = (BuyStartItem) action;</span>

<span class="nc bnc" id="L466" title="All 2 branches missed.">                if (!buyAction.setSharePriceOnly()) {</span>
<span class="nc" id="L467">                    selected = buyAction.isSelected();</span>
<span class="nc bnc" id="L468" title="All 2 branches missed.">                    if (selected) {</span>
<span class="nc" id="L469">                        buyButton.setPossibleAction(action);</span>
                    } else {
                        //itemNameButton[i].setToolTipText(LocalText.getText(&quot;ClickToSelectForBuying&quot;));
<span class="nc" id="L472">                        itemNameButton[i].setPossibleAction(action);</span>
                    }
<span class="nc" id="L474">                    itemNameButton[i].setSelected(selected);</span>
<span class="nc bnc" id="L475" title="All 2 branches missed.">                    itemNameButton[i].setEnabled(!selected);</span>
<span class="nc" id="L476">                    setItemNameButton(i, true);</span>
<span class="nc bnc" id="L477" title="All 4 branches missed.">                    if (includeBidding &amp;&amp; showBasePrices)</span>
<span class="nc" id="L478">                        minBid[i].setText(&quot;&quot;);</span>
<span class="nc" id="L479">                    buyAllowed = selected;</span>

                } else {
<span class="nc" id="L482">                    PossibleAction lastAction = gameUIManager.getLastAction();</span>
<span class="nc bnc" id="L483" title="All 2 branches missed.">                    if (lastAction instanceof GameAction</span>
<span class="nc bnc" id="L484" title="All 2 branches missed.">                            &amp;&amp; EnumSet.of(GameAction.Mode.UNDO, GameAction.Mode.FORCED_UNDO).contains(</span>
<span class="nc" id="L485">                            ((GameAction) lastAction).getMode() )) {</span>
                        // If we come here via an Undo, we should not start
                        // with a modal dialog, as that would prevent further
                        // Undos.
                        // So there is an extra step: let the player press Buy
                        // first.
<span class="nc" id="L491">                        setItemNameButton(i, true);</span>
<span class="nc" id="L492">                        itemNameButton[i].setSelected(true);</span>
<span class="nc" id="L493">                        itemNameButton[i].setEnabled(false);</span>
<span class="nc" id="L494">                        buyButton.setPossibleAction(action);</span>
<span class="nc" id="L495">                        buyAllowed = true;</span>

                    } else {
<span class="nc" id="L498">                        immediateAction = action;</span>
                    }
<span class="nc" id="L500">                }</span>

<span class="nc bnc" id="L502" title="All 2 branches missed.">            } else if (action instanceof BidStartItem) {</span>
<span class="nc" id="L503">                BidStartItem bidAction = (BidStartItem) action;</span>
<span class="nc" id="L504">                selected = bidAction.isSelected();</span>
<span class="nc bnc" id="L505" title="All 2 branches missed.">                if (selected) {</span>
<span class="nc" id="L506">                    bidButton.addPossibleAction(action);</span>
<span class="nc" id="L507">                    bidButton.setPossibleAction(action);</span>
<span class="nc" id="L508">                    int mb = bidAction.getMinimumBid();</span>
<span class="nc" id="L509">                    spinnerModel.setMinimum(mb);</span>
<span class="nc" id="L510">                    spinnerModel.setStepSize(bidAction.getBidIncrement());</span>
<span class="nc" id="L511">                    spinnerModel.setValue(mb);</span>
<span class="nc" id="L512">                } else {</span>
<span class="nc" id="L513">                    itemNameButton[i].setPossibleAction(action);</span>
                }
<span class="nc" id="L515">                bidAllowed = selected;</span>
<span class="nc" id="L516">                itemNameButton[i].setSelected(selected);</span>
<span class="nc bnc" id="L517" title="All 2 branches missed.">                itemNameButton[i].setEnabled(!selected);</span>
<span class="nc" id="L518">                setItemNameButton(i, true);</span>
<span class="nc" id="L519">                minBid[i].setText(Bank.format(item, item.getMinimumBid()));</span>
            }
<span class="nc" id="L521">        }</span>

<span class="nc" id="L523">        boolean passAllowed = false;</span>

<span class="nc" id="L525">        List&lt;NullAction&gt; inactiveItems = possibleActions.getType(NullAction.class);</span>
<span class="nc bnc" id="L526" title="All 4 branches missed.">        if (inactiveItems != null &amp;&amp; !inactiveItems.isEmpty()) {</span>
            // only one NullAction is allowed
<span class="nc" id="L528">            NullAction na = inactiveItems.get(0);</span>
            // nullActions differ in text to display
<span class="nc" id="L530">            passButton.setRailsIcon(RailsIcon.getByConfigKey(na.getMode().name()));</span>
<span class="nc" id="L531">            passAllowed = true;</span>
<span class="nc" id="L532">            passButton.setPossibleAction(na);</span>
<span class="nc" id="L533">            passButton.setMnemonic(KeyEvent.VK_P);</span>
        }

<span class="nc bnc" id="L536" title="All 2 branches missed.">        if (includeBuying) {</span>
<span class="nc" id="L537">            buyButton.setEnabled(buyAllowed);</span>
        }

<span class="nc bnc" id="L540" title="All 2 branches missed.">        if (includeBidding) {</span>
<span class="nc" id="L541">            bidButton.setEnabled(bidAllowed);</span>
<span class="nc" id="L542">            bidAmount.setEnabled(bidAllowed);</span>
        }
<span class="nc" id="L544">        passButton.setEnabled(passAllowed);</span>

<span class="nc" id="L546">        pack(); // to avoid not displaying after label size changes</span>
<span class="nc" id="L547">        requestFocus();</span>
<span class="nc" id="L548">    }</span>

    public boolean processImmediateAction() {
<span class="nc bnc" id="L551" title="All 2 branches missed.">        if (immediateAction != null) {</span>
<span class="nc" id="L552">            log.debug(&quot;ImmediateAction = {}&quot;, immediateAction);</span>
            // Make a local copy and discard the original,
            // so that it's not going to loop.
<span class="nc" id="L555">            PossibleAction nextAction = immediateAction;</span>
<span class="nc" id="L556">            immediateAction = null;</span>
<span class="nc bnc" id="L557" title="All 2 branches missed.">            if (nextAction instanceof StartItemAction) {</span>
<span class="nc" id="L558">                StartItemAction action = (StartItemAction) nextAction;</span>
<span class="nc bnc" id="L559" title="All 2 branches missed.">                if (action instanceof BuyStartItem) {</span>
<span class="nc" id="L560">                    requestStartPrice((BuyStartItem) action);</span>
<span class="nc" id="L561">                    return false;</span>
                }
            }
        }
<span class="nc" id="L565">        return true;</span>
    }

    /*
     * (non-Javadoc)
     *
     * @see java.awt.event.ActionListener#actionPerformed(java.awt.event.ActionEvent)
     */
    public void actionPerformed(ActionEvent actor) {
<span class="nc" id="L574">        JComponent source = (JComponent) actor.getSource();</span>

<span class="nc bnc" id="L576" title="All 2 branches missed.">        if (source instanceof ClickField) {</span>
<span class="nc" id="L577">            gbc = gb.getConstraints(source);</span>
<span class="nc" id="L578">            StartItemAction currentActiveItem = (StartItemAction) ((ClickField) source).getPossibleActions().get(0);</span>

            //notify sound manager that click field has been selected
<span class="nc" id="L581">            SoundManager.notifyOfClickFieldSelection(currentActiveItem);</span>

            //notify sound manager that click field has been selected
<span class="nc" id="L584">            SoundManager.notifyOfClickFieldSelection(currentActiveItem);</span>

<span class="nc bnc" id="L586" title="All 2 branches missed.">            if (currentActiveItem instanceof BuyStartItem) {</span>
<span class="nc" id="L587">                buyButton.setEnabled(true);</span>
<span class="nc" id="L588">                buyButton.setPossibleAction(currentActiveItem);</span>
<span class="nc bnc" id="L589" title="All 2 branches missed.">                if (includeBidding) {</span>
<span class="nc" id="L590">                    bidButton.setEnabled(false);</span>
<span class="nc" id="L591">                    bidAmount.setEnabled(false);</span>
                }
<span class="nc bnc" id="L593" title="All 2 branches missed.">            } else if (currentActiveItem instanceof BidStartItem) {</span>
<span class="nc" id="L594">                BidStartItem bidAction = (BidStartItem) currentActiveItem;</span>
<span class="nc bnc" id="L595" title="All 2 branches missed.">                if (includeBuying) {</span>
<span class="nc" id="L596">                    buyButton.setEnabled(false);</span>
                }

<span class="nc bnc" id="L599" title="All 2 branches missed.">                if (bidAction.isSelectForAuction()) {</span>
                    // In this case, &quot;Pass&quot; becomes &quot;Select, don't buy&quot;
<span class="nc" id="L601">                    passButton.setPossibleAction(currentActiveItem);</span>
<span class="nc" id="L602">                    passButton.setEnabled(true);</span>
<span class="nc" id="L603">                    passButton.setRailsIcon(RailsIcon.SELECT_NO_BID);</span>
<span class="nc" id="L604">                    passButton.setVisible(true);</span>
                    //                    if (!repacked) {
<span class="nc" id="L606">                    pack();</span>
                    //                        repacked = true;
                    //                    }

                }
<span class="nc bnc" id="L611" title="All 2 branches missed.">                if (includeBidding) {</span>
<span class="nc" id="L612">                    bidButton.setEnabled(true);</span>
<span class="nc" id="L613">                    bidButton.setPossibleAction(currentActiveItem);</span>
<span class="nc" id="L614">                    bidAmount.setEnabled(true);</span>
<span class="nc" id="L615">                    int minBid = bidAction.getMinimumBid();</span>
<span class="nc" id="L616">                    spinnerModel.setMinimum(minBid);</span>
<span class="nc" id="L617">                    spinnerModel.setStepSize(bidAction.getBidIncrement());</span>
<span class="nc" id="L618">                    spinnerModel.setValue(minBid);</span>
                }
            }
<span class="nc bnc" id="L621" title="All 2 branches missed.">        } else if (source instanceof ActionButton) {</span>
<span class="nc" id="L622">            PossibleAction activeItem =</span>
<span class="nc" id="L623">                ((ActionButton) source).getPossibleActions().get(0);</span>

<span class="nc bnc" id="L625" title="All 2 branches missed.">            if (source == buyButton) {</span>
<span class="nc bnc" id="L626" title="All 2 branches missed.">                if (activeItem instanceof BuyStartItem</span>
<span class="nc bnc" id="L627" title="All 2 branches missed.">                        &amp;&amp; ((BuyStartItem) activeItem).hasSharePriceToSet()) {</span>
<span class="nc bnc" id="L628" title="All 2 branches missed.">                    if (requestStartPrice((BuyStartItem) activeItem)) return;</span>
                } else {
<span class="nc" id="L630">                    process(activeItem);</span>
                }
<span class="nc bnc" id="L632" title="All 2 branches missed.">            } else if (source == bidButton) {</span>
<span class="nc" id="L633">                ((BidStartItem) activeItem).setActualBid(((Integer) spinnerModel.getValue()));</span>
<span class="nc" id="L634">                process(activeItem);</span>

<span class="nc bnc" id="L636" title="All 2 branches missed.">            } else if (source == passButton) {</span>
<span class="nc bnc" id="L637" title="All 2 branches missed.">                if ( activeItem instanceof BidStartItem</span>
<span class="nc bnc" id="L638" title="All 2 branches missed.">                        &amp;&amp; ((BidStartItem) activeItem).isSelectForAuction() ) {</span>
<span class="nc" id="L639">                    ((BidStartItem) activeItem).setActualBid(-1);</span>
                }
<span class="nc" id="L641">                process(activeItem);</span>

            }
        }
<span class="nc" id="L645">    }</span>

    protected boolean requestStartPrice(BuyStartItem activeItem) {

<span class="nc bnc" id="L649" title="All 2 branches missed.">        if (activeItem.hasSharePriceToSet()) {</span>
<span class="nc" id="L650">            String compName = activeItem.getCompanyToSetPriceFor();</span>
<span class="nc" id="L651">            StockMarket stockMarket = gameUIManager.getRoot().getStockMarket();</span>

            // Get a sorted prices List
            // TODO: should be included in BuyStartItem

<span class="nc bnc" id="L656" title="All 2 branches missed.">            if (activeItem.containsStartSpaces()) {</span>
<span class="nc" id="L657">                startSpaces = new TreeSet&lt;StockSpace&gt;();</span>
<span class="nc bnc" id="L658" title="All 2 branches missed.">                for (String s : activeItem.startSpaces()) {</span>
<span class="nc" id="L659">                    startSpaces.add(stockMarket.getStockSpace(s));</span>
<span class="nc" id="L660">                }</span>
            } else {
<span class="nc" id="L662">                startSpaces = stockMarket.getStartSpaces();</span>
            }
<span class="nc" id="L664">            String[] options = new String[startSpaces.size()];</span>
<span class="nc" id="L665">            int i = 0;</span>
<span class="nc bnc" id="L666" title="All 2 branches missed.">            for (StockSpace space:startSpaces) {</span>
<span class="nc" id="L667">                options[i++] = gameUIManager.format(space.getPrice());</span>
<span class="nc" id="L668">            }</span>

<span class="nc" id="L670">            RadioButtonDialog dialog = new RadioButtonDialog(</span>
                    COMPANY_START_PRICE_DIALOG,
                    this,
                    this,
<span class="nc" id="L674">                    LocalText.getText(&quot;PleaseSelect&quot;),</span>
<span class="nc" id="L675">                    LocalText.getText(&quot;WHICH_START_PRICE&quot;,</span>
<span class="nc" id="L676">                            getSRPlayer(),</span>
                            compName),
                            options,
                            -1);
<span class="nc" id="L680">            setCurrentDialog (dialog, activeItem);</span>

        }
<span class="nc" id="L683">        return true;</span>
    }

    public JDialog getCurrentDialog() {
<span class="nc" id="L687">        return currentDialog;</span>
    }

    public PossibleAction getCurrentDialogAction () {
<span class="nc" id="L691">        return currentDialogAction;</span>
    }

    public void setCurrentDialog (JDialog dialog, PossibleAction action) {
<span class="nc bnc" id="L695" title="All 2 branches missed.">        if (currentDialog != null) {</span>
<span class="nc" id="L696">            currentDialog.dispose();</span>
        }
<span class="nc" id="L698">        currentDialog = dialog;</span>
<span class="nc" id="L699">        currentDialogAction = action;</span>
<span class="nc" id="L700">        disableButtons();</span>
<span class="nc" id="L701">    }</span>

    public void dialogActionPerformed () {

<span class="nc bnc" id="L705" title="All 4 branches missed.">        if (currentDialog instanceof RadioButtonDialog</span>
                &amp;&amp; currentDialogAction instanceof BuyStartItem) {

<span class="nc" id="L708">            RadioButtonDialog dialog = (RadioButtonDialog) currentDialog;</span>
<span class="nc" id="L709">            BuyStartItem action = (BuyStartItem) currentDialogAction;</span>

<span class="nc" id="L711">            int index = dialog.getSelectedOption();</span>
<span class="nc bnc" id="L712" title="All 2 branches missed.">            if (index &gt;= 0) {</span>
<span class="nc" id="L713">                int price = Iterables.get(startSpaces, index).getPrice();</span>
<span class="nc" id="L714">                action.setAssociatedSharePrice(price);</span>
<span class="nc" id="L715">                process (action);</span>
<span class="nc" id="L716">            } else {</span>
                // No selection done - no action
<span class="nc" id="L718">                return;</span>
            }

<span class="nc" id="L721">        } else {</span>
<span class="nc" id="L722">            return;</span>
        }
<span class="nc" id="L724">    }</span>

    protected void disableButtons() {
<span class="nc bnc" id="L727" title="All 2 branches missed.">        if (includeBidding){</span>
<span class="nc" id="L728">        bidButton.setEnabled(false);</span>
        }
<span class="nc bnc" id="L730" title="All 2 branches missed.">        if (includeBuying) {</span>
<span class="nc" id="L731">            buyButton.setEnabled(false);</span>
        }
<span class="nc" id="L733">        passButton.setEnabled(false);</span>
<span class="nc" id="L734">    }</span>

    public void close() {
<span class="nc" id="L737">        this.dispose();</span>
<span class="nc" id="L738">    }</span>

    public void setSRPlayerTurn(int selectedPlayerIndex) {
        int j;

<span class="nc bnc" id="L743" title="All 2 branches missed.">        if ((j = this.playerIndex) &gt;= 0) {</span>
<span class="nc" id="L744">            upperPlayerCaption[j].setHighlight(false);</span>
<span class="nc" id="L745">            lowerPlayerCaption[j].setHighlight(false);</span>
        }
<span class="nc" id="L747">        this.playerIndex = selectedPlayerIndex;</span>
<span class="nc bnc" id="L748" title="All 2 branches missed.">        if ((j = this.playerIndex) &gt;= 0) {</span>
<span class="nc" id="L749">            upperPlayerCaption[j].setHighlight(true);</span>
<span class="nc" id="L750">            lowerPlayerCaption[j].setHighlight(true);</span>
        }
<span class="nc" id="L752">    }</span>

    public String getSRPlayer() {
<span class="nc bnc" id="L755" title="All 2 branches missed.">        if (playerIndex &gt;= 0)</span>
<span class="nc" id="L756">            return players[playerIndex].getId();</span>
        else
<span class="nc" id="L758">            return &quot;&quot;;</span>
    }

    private void setItemNameButton(int i, boolean clickable) {

<span class="nc bnc" id="L763" title="All 2 branches missed.">        itemName[i].setVisible(!clickable);</span>
<span class="nc" id="L764">        itemNameButton[i].setVisible(clickable);</span>

<span class="nc" id="L766">        int status = Integer.parseInt(itemStatus[i].getText());</span>
<span class="nc" id="L767">        String tooltip = LocalText.getText(itemStatusTextKeys[status]);</span>

<span class="nc bnc" id="L769" title="All 2 branches missed.">        itemName[i].setToolTipText(clickable ? &quot;&quot; : tooltip);</span>
<span class="nc bnc" id="L770" title="All 2 branches missed.">        itemNameButton[i].setToolTipText(clickable ? tooltip : &quot;&quot;);</span>

<span class="nc" id="L772">        itemName[i].setForeground (</span>
<span class="nc bnc" id="L773" title="All 2 branches missed.">                status == StartItem.SOLD ? soldColour : defaultColour);</span>
<span class="nc" id="L774">        itemNameButton[i].setForeground (</span>
<span class="nc bnc" id="L775" title="All 2 branches missed.">                status == StartItem.BUYABLE ? buyableColour : defaultColour);</span>
<span class="nc" id="L776">    }</span>

    private String getStartItemDescription (StartItem item) {
<span class="nc" id="L779">        StringBuilder b = new StringBuilder(&quot;&lt;html&gt;&quot;);</span>
<span class="nc" id="L780">        b.append(item.getPrimary().toText());</span>
<span class="nc bnc" id="L781" title="All 2 branches missed.">        if (item.getPrimary() instanceof PrivateCompany) {</span>
<span class="nc" id="L782">            PrivateCompany priv = (PrivateCompany) item.getPrimary();</span>
<span class="nc" id="L783">                b.append (&quot;&lt;br&gt;Revenue: &quot;).append(Bank.format(item, priv.getRevenue()));</span>
<span class="nc" id="L784">            List&lt;MapHex&gt; blockedHexes = priv.getBlockedHexes();</span>
<span class="nc bnc" id="L785" title="All 2 branches missed.">            if (blockedHexes == null) {</span>
<span class="nc bnc" id="L786" title="All 2 branches missed.">            } else if (blockedHexes.size() == 1) {</span>
<span class="nc" id="L787">                    b.append(&quot;&lt;br&gt;Blocked hex: &quot;).append(blockedHexes.get(0).getId());</span>
<span class="nc bnc" id="L788" title="All 2 branches missed.">            } else if (blockedHexes.size() &gt; 1) {</span>
<span class="nc" id="L789">                b.append(&quot;&lt;br&gt;Blocked hexes:&quot;);</span>
<span class="nc bnc" id="L790" title="All 2 branches missed.">                for (MapHex hex : blockedHexes) {</span>
<span class="nc" id="L791">                        b.append(&quot; &quot;).append(hex.getId());</span>
<span class="nc" id="L792">                }</span>
            }
<span class="nc bnc" id="L794" title="All 2 branches missed.">            if (priv.hasSpecialProperties()) {</span>
<span class="nc" id="L795">                b.append(&quot;&lt;br&gt;&lt;b&gt;Special properties:&lt;/b&gt;&quot;);</span>
<span class="nc bnc" id="L796" title="All 2 branches missed.">                    for (SpecialProperty sp : priv.getSpecialProperties()) {</span>
<span class="nc" id="L797">                    b.append(&quot;&lt;br&gt;&quot;).append(sp.getInfo());</span>
<span class="nc" id="L798">                }</span>
            }
            // sfy 1889
<span class="nc" id="L801">            List&lt;String&gt; preventClosingConditions = priv.getPreventClosingConditions();</span>
<span class="nc bnc" id="L802" title="All 2 branches missed.">            if (!preventClosingConditions.isEmpty()) {</span>
<span class="nc" id="L803">                b.append(&quot;&lt;br&gt;&lt;b&gt;Prevent closing conditions:&lt;/b&gt;&quot;);</span>
<span class="nc bnc" id="L804" title="All 2 branches missed.">                for (String condition : preventClosingConditions) {</span>
<span class="nc" id="L805">                    b.append(&quot;&lt;br&gt;&quot;).append(condition);</span>
<span class="nc" id="L806">                }</span>
            }

        }
<span class="nc bnc" id="L810" title="All 2 branches missed.">        if (item.getSecondary() != null) {</span>
<span class="nc" id="L811">            b.append(&quot;&lt;br&gt;&lt;b&gt;Also contains:&lt;/b&gt;&lt;br&gt;&quot;);</span>
<span class="nc" id="L812">            b.append(item.getSecondary().toText());</span>
        }
<span class="nc" id="L814">        return b.toString();</span>
    }

    private ImageIcon createInfoIcon() {
<span class="nc" id="L818">        return RailsIcon.INFO.smallIcon;</span>
    }

<span class="nc" id="L821">    public void keyPressed(KeyEvent e) {}</span>

<span class="nc" id="L823">    public void keyReleased(KeyEvent e) {}</span>

<span class="nc" id="L825">    public void keyTyped(KeyEvent e) {}</span>

    public boolean process(PossibleAction action) {
<span class="nc" id="L828">        return gameUIManager.processAction(action);</span>
    }

    public void updatePlayerOrder(List&lt;String&gt; newPlayerNames) {
<span class="nc" id="L832">        int[] xref = new int[np];</span>
<span class="nc" id="L833">        List&lt;String&gt; oldPlayerNames = gameUIManager.getCurrentGuiPlayerNames();</span>
<span class="nc bnc" id="L834" title="All 2 branches missed.">       for (int i=0; i&lt;np; i++) {</span>
<span class="nc" id="L835">            xref[i] = oldPlayerNames.indexOf(newPlayerNames.get(i));</span>
        }
<span class="nc" id="L837">        log.debug(&quot;SRW: old player list: {}&quot;, Util.joinWithDelimiter(oldPlayerNames.toArray(new String[0]), &quot;,&quot;));</span>
<span class="nc" id="L838">        log.debug(&quot;SRW: new player list: {}&quot;, Util.joinWithDelimiter(newPlayerNames.toArray(new String[0]), &quot;,&quot;));</span>


<span class="nc" id="L841">        JComponent[] cells = new Cell[np];</span>
<span class="nc" id="L842">        GridBagConstraints[] constraints = new GridBagConstraints[np];</span>
        JComponent f;
<span class="nc bnc" id="L844" title="All 2 branches missed.">        for (int y=upperPlayerCaptionYOffset; y&lt;=lowerPlayerCaptionYOffset; y++) {</span>
<span class="nc bnc" id="L845" title="All 2 branches missed.">         for (int i=0, x=playerCaptionXOffset; i&lt;np; i++, x++) {</span>
<span class="nc" id="L846">                cells[i] = fields[x][y];</span>
<span class="nc" id="L847">                constraints[i] = gb.getConstraints(cells[i]);</span>
<span class="nc" id="L848">               statusPanel.remove(cells[i]);</span>
            }
<span class="nc bnc" id="L850" title="All 2 branches missed.">            for (int i=0, x=playerCaptionXOffset; i&lt;np; i++, x++) {</span>
<span class="nc" id="L851">               f = fields[x][y] = cells[xref[i]];</span>
<span class="nc" id="L852">               statusPanel.add (f, constraints[i]);</span>
            }
        }
<span class="nc bnc" id="L855" title="All 2 branches missed.">        for (int i=0, x=playerCaptionXOffset; i&lt;np; i++, x++) {</span>
<span class="nc" id="L856">            upperPlayerCaption[i] = (Field) fields[x][upperPlayerCaptionYOffset];</span>
<span class="nc" id="L857">            lowerPlayerCaption[i] = (Field) fields[x][lowerPlayerCaptionYOffset];</span>
        }

<span class="nc" id="L860">        gameUIManager.packAndApplySizing(this);</span>
<span class="nc" id="L861">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>