<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="de"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SetDividend.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Rails</a> &gt; <a href="index.source.html" class="el_package">rails.game.action</a> &gt; <span class="el_source">SetDividend.java</span></div><h1>SetDividend.java</h1><pre class="source lang-java linenums">package rails.game.action;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.util.Arrays;

import com.google.common.base.Objects;
import net.sf.rails.util.RailsObjects;
import net.sf.rails.util.Util;

/**
 * Action class that comprises the earnings setting and distribution steps. In
 * the current versions, the earnings must always be calculated and entered by
 * the user. In a later version, the earnings may have been calculated by the
 * back-end; in that case, the user can only select the earnings distribution
 * method.
 *
 * Rails 2.0: Updated equals and toString methods
 */
public class SetDividend extends PossibleORAction implements Cloneable {

    public static final int UNKNOWN = -1;
    public static final int WITHHOLD = 0;
    public static final int SPLIT = 1;
    public static final int PAYOUT = 2;
    public static final int NO_TRAIN = 3;
    public static final int NUM_OPTIONS = 4;

    /** Allocation name keys in the resource bundle */
<span class="fc" id="L30">    protected static final String[] allocationNameKeys =</span>
            new String[] { &quot;WITHHOLD&quot;, &quot;SPLIT&quot;, &quot;PAYOUT&quot;, &quot;NO_TRAIN&quot; };

    /*--- Server-side settings ---*/
    /**
     * The revenue as proposed by the back-end. Currently this is always the
     * previous revenue. In the future, this could be the calculated revenue.
     */
    protected int presetRevenue;

    /**
     * Is the user allowed to set the revenue? Currently, this will aways be
     * true, except if the company has no trains (the revenue is then 0). In the
     * future, it will only be true if the user has some influence on it (e.g.,
     * in 1844, the user may opt for less that maximum revenue is some cases).
     */
<span class="fc" id="L46">    private boolean mayUserSetRevenue = true;</span>

    /**
     * The revenue allocations that the user may select from. If only one value
     * is provided, the user has no option (e.g. minor companies always split in
     * most games).
     */
    private int[] allowedRevenueAllocations;

    /** Cash that should be minimally raised as revenue
     * (for instance, to pay loan interest as in 1856).
     * If actual revenue is below this value, the dividend will be zero,
     * and no dividend allocation should be requested.
     * */
<span class="fc" id="L60">    protected int requiredCash = 0;</span>

    /*--- Client-side settings ---*/

    /** The revenue as set (or accepted, or just seen) by the user. */
<span class="fc" id="L65">    protected int actualRevenue = 0;</span>

    /** The revenue destination selected by the user (if he has a choice at all). */
    protected int revenueAllocation;

    /**The
     * The direct revenue for the company treasury (not as dividend) as proposed by the back-end. Currently this is always the
     * previous revenue. In the future, this could be the calculated revenue.
     */
<span class="fc" id="L74">    private int presetCompanyTreasuryRevenue = 0;</span>
<span class="fc" id="L75">    private int actualCompanyTreasuryRevenue = 0;</span>

    public static final long serialVersionUID = 1L;

    public SetDividend(int presetRevenue, boolean mayUserSetRevenue,
            int[] allowedAllocations) {
<span class="fc" id="L81">        this (presetRevenue, 0, mayUserSetRevenue, allowedAllocations, 0);</span>
<span class="fc" id="L82">    }</span>

    public SetDividend(int presetRevenue, boolean mayUserSetRevenue,
                int[] allowedAllocations, int requiredCash) {
<span class="fc" id="L86">        this (presetRevenue, 0, mayUserSetRevenue, allowedAllocations, requiredCash);</span>
<span class="fc" id="L87">    }</span>

    public SetDividend(int presetRevenue, int presetCompanyTreasuryRevenue, boolean mayUserSetRevenue,
            int[] allowedAllocations, int requiredCash) {
<span class="fc" id="L91">        super();</span>
<span class="fc" id="L92">        this.presetRevenue = presetRevenue;</span>
<span class="fc" id="L93">        this.presetCompanyTreasuryRevenue = presetCompanyTreasuryRevenue;</span>
<span class="fc" id="L94">        this.setMayUserSetRevenue(mayUserSetRevenue);</span>
<span class="fc" id="L95">        this.setAllowedRevenueAllocations(allowedAllocations.clone());</span>
<span class="fc" id="L96">        this.requiredCash = requiredCash;</span>
<span class="fc bfc" id="L97" title="All 2 branches covered.">        if (getAllowedRevenueAllocations().length == 1) {</span>
<span class="fc" id="L98">            revenueAllocation = getAllowedRevenueAllocations()[0];</span>
        } else {
<span class="fc" id="L100">            revenueAllocation = UNKNOWN;</span>
        }
<span class="fc" id="L102">    }</span>


    /** Clone an instance (used by clone) */
    protected SetDividend(SetDividend action) {

<span class="nc" id="L108">        this(action.presetRevenue,</span>
                action.presetCompanyTreasuryRevenue,
<span class="nc" id="L110">                action.getMayUserSetRevenue(),</span>
<span class="nc" id="L111">                action.getAllowedRevenueAllocations(),</span>
                action.requiredCash);
<span class="nc" id="L113">    }</span>

    public int getPresetRevenue() {
<span class="nc" id="L116">        return presetRevenue;</span>
    }

    public void setActualRevenue(int revenue) {
<span class="nc" id="L120">        actualRevenue = revenue;</span>
<span class="nc" id="L121">    }</span>

    public int getActualRevenue() {
<span class="fc" id="L124">        return actualRevenue;</span>
    }

    public void setActualCompanyTreasuryRevenue(
            int actualCompanyTreasuryRevenue) {
<span class="nc" id="L129">        this.actualCompanyTreasuryRevenue = actualCompanyTreasuryRevenue;</span>
<span class="nc" id="L130">    }</span>

    public int getActualCompanyTreasuryRevenue() {
<span class="nc" id="L133">                    return actualCompanyTreasuryRevenue;</span>
    }

    public int getPresetCompanyTreasuryRevenue() {
<span class="nc" id="L137">        return presetCompanyTreasuryRevenue;</span>
    }

    public int[] getAllowedAllocations() {
<span class="fc" id="L141">        return getAllowedRevenueAllocations();</span>
    }

    public boolean isAllocationAllowed(int allocationType) {
<span class="nc bnc" id="L145" title="All 2 branches missed.">        for (int at : getAllowedRevenueAllocations()) {</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">            if (at == allocationType) return true;</span>
        }
<span class="nc" id="L148">        return false;</span>
    }

    public int getRequiredCash() {
<span class="nc" id="L152">        return requiredCash;</span>
    }

    public void setRevenueAllocation(int allocation) {
<span class="fc" id="L156">        revenueAllocation = allocation;</span>
<span class="fc" id="L157">    }</span>

    public int getRevenueAllocation() {
<span class="fc" id="L160">        return revenueAllocation;</span>
    }

    public static String getAllocationNameKey(int allocationType) {
<span class="pc bpc" id="L164" title="2 of 4 branches missed.">        if (allocationType &gt;= 0 &amp;&amp; allocationType &lt; NUM_OPTIONS) {</span>
<span class="fc" id="L165">            return allocationNameKeys[allocationType];</span>
        } else {
<span class="nc" id="L167">            return &quot;&lt;invalid allocation type: &quot; + allocationType + &quot;&gt;&quot;;</span>
        }
    }

    @Override
    public Object clone() {

<span class="nc" id="L174">        SetDividend result = new SetDividend(this);</span>
<span class="nc" id="L175">        result.setActualRevenue(actualRevenue);</span>
<span class="nc" id="L176">        result.setActualCompanyTreasuryRevenue(actualCompanyTreasuryRevenue);</span>
<span class="nc" id="L177">        result.setRevenueAllocation(revenueAllocation);</span>
<span class="nc" id="L178">        return result;</span>
    }

    @Override
    protected boolean equalsAs(PossibleAction pa, boolean asOption) {
        // identity always true
<span class="pc bpc" id="L184" title="1 of 2 branches missed.">        if (pa == this) return true;</span>
        //  super checks both class identity and super class attributes
<span class="fc bfc" id="L186" title="All 2 branches covered.">        if (!super.equalsAs(pa, asOption)) return false;</span>

        // check asOption attributes
<span class="fc" id="L189">        SetDividend action = (SetDividend)pa;</span>
<span class="fc" id="L190">        boolean options =</span>
<span class="pc bpc" id="L191" title="1 of 2 branches missed.">                Objects.equal(this.presetRevenue, action.presetRevenue)</span>
<span class="pc bpc" id="L192" title="1 of 2 branches missed.">                &amp;&amp; Objects.equal(this.presetCompanyTreasuryRevenue, action.presetCompanyTreasuryRevenue)</span>
<span class="pc bpc" id="L193" title="1 of 2 branches missed.">                &amp;&amp; Objects.equal(this.getMayUserSetRevenue(), action.getMayUserSetRevenue())</span>
<span class="pc bpc" id="L194" title="1 of 2 branches missed.">                &amp;&amp; Arrays.equals(this.getAllowedRevenueAllocations(), action.getAllowedRevenueAllocations())</span>
<span class="pc bpc" id="L195" title="1 of 2 branches missed.">                &amp;&amp; Objects.equal(this.requiredCash, action.requiredCash)</span>
        ;

        // finish if asOptions check
<span class="pc bpc" id="L199" title="1 of 2 branches missed.">        if (asOption) return options;</span>

        // check asAction attributes
<span class="nc bnc" id="L202" title="All 2 branches missed.">        return options</span>
<span class="nc bnc" id="L203" title="All 2 branches missed.">                &amp;&amp; Objects.equal(this.actualRevenue, action.actualRevenue)</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">                &amp;&amp; Objects.equal(this.actualCompanyTreasuryRevenue, action.actualCompanyTreasuryRevenue)</span>
<span class="nc bnc" id="L205" title="All 2 branches missed.">                &amp;&amp; Objects.equal(this.revenueAllocation, action.revenueAllocation)</span>
        ;
    }

    @Override
    public String toString() {
<span class="fc" id="L211">        return super.toString() +</span>
<span class="fc" id="L212">                RailsObjects.stringHelper(this)</span>
<span class="fc" id="L213">                    .addToString(&quot;presetRevenue&quot;, presetRevenue)</span>
<span class="fc" id="L214">                    .addToString(&quot;presetTreasuryBonusRevenue&quot;,presetCompanyTreasuryRevenue)</span>
<span class="fc" id="L215">                    .addToString(&quot;mayUserSetRevenue&quot;, getMayUserSetRevenue())</span>
<span class="fc" id="L216">                    .addToString(&quot;allowedRevenueAllocations&quot;, getAllowedRevenueAllocations())</span>
<span class="fc" id="L217">                    .addToString(&quot;requiredCash&quot;, requiredCash)</span>
<span class="fc" id="L218">                    .addToStringOnlyActed(&quot;actualRevenue&quot;, actualRevenue)</span>
<span class="fc" id="L219">                    .addToStringOnlyActed(&quot;actualCompanyTreasuryRevenue&quot;, actualCompanyTreasuryRevenue)</span>
<span class="fc" id="L220">                    .addToStringOnlyActed(&quot;revenueAllocation&quot;, revenueAllocation)</span>
<span class="fc" id="L221">                    .toString()</span>
        ;
    }

    /** Deserialize */
    private void readObject(ObjectInputStream in) throws IOException,
            ClassNotFoundException {

        // Custom deserialization for backwards compatibility
<span class="fc" id="L230">        ObjectInputStream.GetField fields = in.readFields();</span>
<span class="fc" id="L231">        presetRevenue = fields.get(&quot;presetRevenue&quot;, presetRevenue);</span>
<span class="fc" id="L232">        presetCompanyTreasuryRevenue = fields.get(&quot;presetCompanyTreasuryRevenue&quot;, presetCompanyTreasuryRevenue);</span>
<span class="fc" id="L233">        setMayUserSetRevenue(fields.get(&quot;mayUserSetRevenue&quot;, getMayUserSetRevenue()));</span>
<span class="fc" id="L234">        setAllowedRevenueAllocations((int[]) fields.get(&quot;allowedRevenueAllocations&quot;, getAllowedRevenueAllocations()));</span>
<span class="fc" id="L235">        requiredCash = fields.get(&quot;requiredCash&quot;, 0);</span>
<span class="fc" id="L236">        actualRevenue = fields.get(&quot;actualRevenue&quot;, actualRevenue);</span>
<span class="fc" id="L237">        actualCompanyTreasuryRevenue = fields.get(&quot;actualCompanyTreasuryRevenue&quot;, actualCompanyTreasuryRevenue);</span>
<span class="fc" id="L238">        revenueAllocation = fields.get(&quot;revenueAllocation&quot;, revenueAllocation);</span>

<span class="pc bpc" id="L240" title="1 of 2 branches missed.">        if (Util.hasValue(companyName)) {</span>
<span class="fc" id="L241">            company = getCompanyManager().getPublicCompany(companyName);</span>
        }
<span class="fc" id="L243">    }</span>

    public boolean getMayUserSetRevenue() {
<span class="fc" id="L246">        return mayUserSetRevenue;</span>
    }

    public void setMayUserSetRevenue(boolean mayUserSetRevenue) {
<span class="fc" id="L250">        this.mayUserSetRevenue = mayUserSetRevenue;</span>
<span class="fc" id="L251">    }</span>

    public int[] getAllowedRevenueAllocations() {
<span class="fc" id="L254">        return allowedRevenueAllocations;</span>
    }

    public void setAllowedRevenueAllocations(
            int[] allowedRevenueAllocations) {
<span class="fc" id="L259">        this.allowedRevenueAllocations = allowedRevenueAllocations;</span>
<span class="fc" id="L260">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>