<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="de"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Root.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Rails</a> &gt; <a href="index.source.html" class="el_package">net.sf.rails.game.state</a> &gt; <span class="el_source">Root.java</span></div><h1>Root.java</h1><pre class="source lang-java linenums">package net.sf.rails.game.state;

import static com.google.common.base.Preconditions.checkArgument;

import java.util.List;

import com.google.common.collect.Lists;
/**
 * Root is the top node of the context/item hierachy
 */
public class Root extends Context{
    
   public final static String ID = &quot;&quot;; 
   private final static String TEXT_ID = &quot;root&quot;;

   private StateManager stateManager;
   private HashMapState&lt;String, Item&gt; items;

   // only used during creation
<span class="fc" id="L20">   private boolean delayItems = true;</span>
<span class="fc" id="L21">   private final List&lt;Item&gt; delayedItems = Lists.newArrayList();</span>
    
<span class="fc" id="L23">   protected Root() {</span>
<span class="fc" id="L24">       addItem(this);</span>
<span class="fc" id="L25">   }</span>

   /**
    * @return a Root object with everything initialized (including sub-components like StateManager)
    */
   public static Root create() {
       // precise sequence to avoid any uninitialized problems
<span class="fc" id="L32">       Root root = new Root();</span>
<span class="fc" id="L33">       root.init();</span>
<span class="fc" id="L34">       return root;</span>
   }
   
   protected void init() {
<span class="fc" id="L38">       StateManager stateManager = StateManager.create(this, &quot;states&quot;);</span>
<span class="fc" id="L39">       this.stateManager = stateManager;</span>
<span class="fc" id="L40">       stateManager.init();</span>
<span class="fc" id="L41">       initDelayedItems();</span>
<span class="fc" id="L42">   }</span>

   private void initDelayedItems() {
<span class="fc" id="L45">       items = HashMapState.create(this, &quot;items&quot;);</span>
<span class="fc bfc" id="L46" title="All 2 branches covered.">       for (Item item: delayedItems) {</span>
<span class="fc" id="L47">           items.put(item.getFullURI(), item);</span>
<span class="fc" id="L48">       }</span>
<span class="fc" id="L49">       delayItems = false;</span>
<span class="fc" id="L50">   }</span>
   
   public StateManager getStateManager() {
<span class="fc" id="L53">       return stateManager;</span>
   }

   // Item methods
   
   /**
    * @throws UnsupportedOperationsException
    * Not supported for Root
    */
   public Item getParent() {
<span class="fc" id="L63">       throw new UnsupportedOperationException();</span>
   }

   public String getId() {
<span class="fc" id="L67">       return &quot;&quot;;</span>
   }
   
   /**
    * @return this
    */
   public Context getContext() {
<span class="fc" id="L74">       return this;</span>
   }
   
   /**
    * @return this
    */
   public Root getRoot() {
<span class="fc" id="L81">       return this;</span>
   }
   
   public String getURI() {
<span class="fc" id="L85">       return &quot;&quot;;</span>
   }

   public String getFullURI() {
<span class="fc" id="L89">       return &quot;&quot;;</span>
   }
   
   public String toText() {
<span class="nc" id="L93">       return TEXT_ID;</span>
   }
   
   // Context methods
   public Item locate(String uri) {
       // first try as fullURI
<span class="fc" id="L99">       Item item = items.get(uri);</span>
<span class="fc bfc" id="L100" title="All 2 branches covered.">       if (item != null) return item;</span>
       // otherwise as local
<span class="fc" id="L102">       return items.get(Item.SEP + uri);</span>
   }

   // used by other context
   Item locateFullURI(String uri) {
<span class="fc" id="L107">       return items.get(uri);</span>
   }
   
   void addItem(Item item) {
       // check if it has to be delayed
<span class="fc bfc" id="L112" title="All 2 branches covered.">       if (delayItems) {</span>
<span class="fc" id="L113">           delayedItems.add(item);</span>
<span class="fc" id="L114">           return;</span>
       }
       
       // check if it already exists
<span class="fc bfc" id="L118" title="All 2 branches covered.">       checkArgument(!items.containsKey(item.getFullURI()), </span>
<span class="fc" id="L119">               &quot;Root already contains item with identical fullURI = &quot; + item.getFullURI());</span>
       
       // all preconditions ok =&gt; add
<span class="fc" id="L122">       items.put(item.getFullURI(), item);</span>
<span class="fc" id="L123">   }</span>

   void removeItem(Item item) {
       // check if it already exists
<span class="fc" id="L127">       checkArgument(items.containsKey(item.getFullURI()), </span>
<span class="fc" id="L128">               &quot;Root does not contain item with that fullURI = &quot; + item.getFullURI());</span>
       
       // all preconditions ok =&gt; remove
<span class="fc" id="L131">       items.remove(item.getFullURI());</span>
<span class="fc" id="L132">   }</span>
   
   @Override
   public String toString() {
<span class="fc" id="L136">       return TEXT_ID;</span>
   }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>