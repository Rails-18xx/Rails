<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="de"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RevenueBonus.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Rails</a> &gt; <a href="index.source.html" class="el_package">net.sf.rails.algorithms</a> &gt; <span class="el_source">RevenueBonus.java</span></div><h1>RevenueBonus.java</h1><pre class="source lang-java linenums">package net.sf.rails.algorithms;

import java.util.Collection;
import java.util.HashMap;
import java.util.List;
import java.util.ArrayList;
import java.util.Map;

import net.sf.rails.game.Phase;
import net.sf.rails.game.Train;
import net.sf.rails.game.TrainType;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;


public final class RevenueBonus {

<span class="nc" id="L19">    private static final Logger log =</span>
<span class="nc" id="L20">        LoggerFactory.getLogger(RevenueBonus.class);</span>

    // bonus values
    private final int value;

    // bonus name, also identifies mutually exclusive bonuses
    private final String name;

    // internal attributes
    private List&lt;NetworkVertex&gt; vertices;
    private List&lt;TrainType&gt; trainTypes;
    private List&lt;Train&gt; trains;
    private List&lt;Phase&gt; phases;

<span class="nc" id="L34">    public RevenueBonus(int value, String name) {</span>
<span class="nc" id="L35">        this.value = value;</span>
<span class="nc" id="L36">        this.name = name;</span>

<span class="nc" id="L38">        vertices = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L39">        trainTypes = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L40">        trains = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L41">        phases = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L42">    }</span>

    public void addVertex(NetworkVertex vertex) {
<span class="nc" id="L45">        vertices.add(vertex);</span>
<span class="nc" id="L46">    }</span>

    public void addVertices(Collection&lt;NetworkVertex&gt; vertices) {
<span class="nc" id="L49">        this.vertices.addAll(vertices);</span>
<span class="nc" id="L50">    }</span>

    public void addTrainType(TrainType trainType) {
<span class="nc" id="L53">        trainTypes.add(trainType);</span>
<span class="nc" id="L54">    }</span>

    public void addTrain(Train train) {
<span class="nc" id="L57">        trains.add(train);</span>
<span class="nc" id="L58">    }</span>

    public void addPhase(Phase phase) {
<span class="nc" id="L61">        phases.add(phase);</span>
<span class="nc" id="L62">    }</span>

    public int getValue() {
<span class="nc" id="L65">        return value;</span>
    }

    public String getName() {
<span class="nc" id="L69">        return name;</span>
    }

    public List&lt;NetworkVertex&gt; getVertices() {
<span class="nc" id="L73">        return vertices;</span>
    }

    public List&lt;TrainType&gt; getTrainTypes() {
<span class="nc" id="L77">        return trainTypes;</span>
    }

    public List&lt;Train&gt; getTrains() {
<span class="nc" id="L81">        return trains;</span>
    }

    public List&lt;Phase&gt; getPhases() {
<span class="nc" id="L85">        return phases;</span>
    }

    public boolean isSimpleBonus() {
<span class="nc bnc" id="L89" title="All 2 branches missed.">        return (vertices.size() == 1);</span>
    }

    public boolean addToRevenueCalculator(RevenueCalculator rc, int bonusId, List&lt;NetworkVertex&gt; allVertices, List&lt;NetworkTrain&gt; trains, Phase phase) {
<span class="nc bnc" id="L93" title="All 6 branches missed.">        if (isSimpleBonus() || !phases.isEmpty() &amp;&amp; !phases.contains(phase)) return false;</span>
        // only non-simple bonuses and checks phase condition

<span class="nc" id="L96">        int[] verticesArray = new int[vertices.size()];</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">        for (int j=0; j &lt; vertices.size(); j++) {</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">            if (!allVertices.contains(vertices.get(j))) return false; // if vertex is not on graph, do not add bonus</span>
<span class="nc" id="L99">            verticesArray[j] = allVertices.indexOf(vertices.get(j));</span>
        }

<span class="nc" id="L102">        boolean[] trainsArray = new boolean[trains.size()];</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">        for (int j=0; j &lt; trains.size(); j++) {</span>
<span class="nc" id="L104">            trainsArray[j] = checkConditions(trains.get(j).getRailsTrain(), phase);</span>
        }

<span class="nc" id="L107">        log.debug(&quot;Add revenueBonus to RC, id = {}, bonus = {}&quot;, bonusId, this);</span>

<span class="nc" id="L109">        rc.setBonus(bonusId, value, verticesArray, trainsArray);</span>

<span class="nc" id="L111">        return true;</span>
    }

    public boolean checkSimpleBonus(NetworkVertex vertex, Train train, Phase phase) {
<span class="nc bnc" id="L115" title="All 6 branches missed.">        return (isSimpleBonus() &amp;&amp; vertices.contains(vertex) &amp;&amp; checkConditions(train, phase));</span>
    }

    public boolean checkComplexBonus(List&lt;NetworkVertex&gt; visitVertices, Train train, Phase phase) {
<span class="nc bnc" id="L119" title="All 4 branches missed.">        boolean result = !isSimpleBonus() &amp;&amp; checkConditions(train, phase);</span>
<span class="nc bnc" id="L120" title="All 2 branches missed.">        if (result) {</span>
<span class="nc bnc" id="L121" title="All 2 branches missed.">            for (NetworkVertex vertex:vertices) {</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">                if (!visitVertices.contains(vertex)) {</span>
<span class="nc" id="L123">                    result = false;</span>
<span class="nc" id="L124">                    break;</span>
                }
<span class="nc" id="L126">            }</span>
        }
<span class="nc" id="L128">        return result;</span>
    }

    public boolean checkConditions(Train train, Phase phase) {
<span class="nc" id="L132">        boolean result = true;</span>

        // check train
<span class="nc bnc" id="L135" title="All 2 branches missed.">        if (!trains.isEmpty()) {</span>
<span class="nc bnc" id="L136" title="All 2 branches missed.">            if (train == null) {</span>
<span class="nc" id="L137">                result = false;</span>
            } else {
<span class="nc bnc" id="L139" title="All 4 branches missed.">                result = result &amp;&amp; trains.contains(train);</span>
            }
        }

        // check trainTypes
<span class="nc bnc" id="L144" title="All 2 branches missed.">        if (!trainTypes.isEmpty()) {</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">            if (train == null) {</span>
<span class="nc" id="L146">                result = false;</span>
            } else {
<span class="nc bnc" id="L148" title="All 4 branches missed.">                result = result &amp;&amp; trainTypes.contains(train.getType());</span>
            }
        }

        // check phase
<span class="nc bnc" id="L153" title="All 2 branches missed.">        if (!phases.isEmpty()) {</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">            if (phase == null) {</span>
<span class="nc" id="L155">                result = false;</span>
            } else {
<span class="nc bnc" id="L157" title="All 4 branches missed.">                result = result &amp;&amp; phases.contains(phase);</span>
            }
        }
<span class="nc" id="L160">        return result;</span>
    }

    @Override
    public String toString() {
<span class="nc" id="L165">        StringBuilder s = new StringBuilder();</span>
<span class="nc" id="L166">        s.append(&quot;RevenueBonus&quot;);</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">        if (name == null)</span>
<span class="nc" id="L168">            s.append (&quot; unnamed&quot;);</span>
        else
<span class="nc" id="L170">            s.append(&quot; name = &quot;).append(name);</span>
<span class="nc" id="L171">        s.append(&quot;, value &quot;).append(value);</span>
<span class="nc" id="L172">        s.append(&quot;, vertices = &quot;).append(vertices);</span>
<span class="nc" id="L173">        s.append(&quot;, trainTypes = &quot;).append(trainTypes);</span>
<span class="nc" id="L174">        s.append(&quot;, phases = &quot;).append(phases);</span>
<span class="nc" id="L175">        return s.toString();</span>
    }

    public static Map&lt;String, Integer&gt; combineBonuses(Collection&lt;RevenueBonus&gt; bonuses){
<span class="nc" id="L179">        Map&lt;String, Integer&gt; combined = new HashMap&lt;String, Integer&gt;();</span>
<span class="nc bnc" id="L180" title="All 2 branches missed.">        for (RevenueBonus bonus:bonuses) {</span>
<span class="nc" id="L181">            String name = bonus.getName();</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">            if (combined.containsKey(name)) {</span>
<span class="nc" id="L183">                combined.put(name, combined.get(name) + bonus.getValue());</span>
            } else {
<span class="nc" id="L185">                combined.put(name, bonus.getValue());</span>
            }
<span class="nc" id="L187">         }</span>
<span class="nc" id="L188">        return combined;</span>
    }

    public static int getNumberNonSimpleBonuses(List&lt;RevenueBonus&gt; bonuses) {
<span class="nc" id="L192">        int number = 0;</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">        for (RevenueBonus bonus:bonuses) {</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">            if (!bonus.isSimpleBonus()) number++;</span>
<span class="nc" id="L195">        }</span>
<span class="nc" id="L196">        return number;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>